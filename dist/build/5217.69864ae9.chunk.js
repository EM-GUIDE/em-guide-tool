"use strict";(self.webpackChunkem_guide_app=self.webpackChunkem_guide_app||[]).push([[5217],{28366:(H,p,e)=>{e.d(p,{A:()=>t,T:()=>n});const t="api-token",n="transfer-token"},35217:(H,p,e)=>{e.r(p),e.d(p,{default:()=>f});var t=e(56940),n=e(30956),I=e(93484),v=e(63355),C=e(75937),M=e(22512),g=e(95984),j=e(54997),i=e(7047),s=e(4549),R=e(48288),O=e(40829),k=e(82018),A=e(28366),S=e(34390),Y=e(21633),b=e(85845),N=e(88720),G=e(66086),z=e(88193),h=e(8232),Z=e(5337),F=e(4357),U=e(41480),B=e(24926),a=e(32635),d=e(42052),c=e(67620),D=e(71999),T=e(333),_=e(21709),l=e(78712);const P=[{name:"name",key:"name",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.name",defaultMessage:"Name"},sortable:!0}},{name:"description",key:"description",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.description",defaultMessage:"Description"},sortable:!1}},{name:"createdAt",key:"createdAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.createdAt",defaultMessage:"Created at"},sortable:!1}},{name:"lastUsedAt",key:"lastUsedAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.lastUsedAt",defaultMessage:"Last used"},sortable:!1}}],m=()=>{(0,n.useFocusWhenNavigate)();const L=(0,O.useQueryClient)(),{formatMessage:u}=(0,R.Z)(),x=(0,n.useNotification)(),$=(0,I.useSelector)(v.s),{allowedActions:{canCreate:y,canDelete:o,canUpdate:V,canRead:E}}=(0,n.useRBAC)($.settings["api-tokens"]),{push:J}=(0,k.k6)(),{trackUsage:W}=(0,n.useTracking)(),{startSection:ee}=(0,n.useGuidedTour)(),X=C.useRef(ee),{get:te,del:se}=(0,n.useFetchClient)(),{formatAPIError:w}=(0,n.useAPIErrorHandler)();C.useEffect(()=>{X.current&&X.current("apiTokens")},[]),C.useEffect(()=>{J({search:s.stringify({sort:"name:ASC"},{encode:!1})})},[J]);const ne=P.map(r=>({...r,metadatas:{...r.metadatas,label:u(r.metadatas.label)}})),{data:K,isLoading:ae}=(0,O.useQuery)(["api-tokens"],async()=>{W("willAccessTokenList",{tokenType:A.A});const{data:{data:r}}=await te("/admin/api-tokens");return W("didAccessTokenList",{number:r.length,tokenType:A.A}),r},{cacheTime:0,enabled:E,onError(r){x({type:"warning",message:w(r)})}}),q=ae,oe=(0,O.useMutation)(async r=>{await se(`/admin/api-tokens/${r}`)},{async onSuccess(){await L.invalidateQueries(["api-tokens"]),W("didDeleteToken")},onError(r){x({type:"warning",message:w(r)})}}),Q=K&&K.length>0,ie=E&&Q,re=E&&!Q&&!y,de=E&&!Q&&y;return(0,t.jsxs)(M.o,{"aria-busy":q,children:[(0,t.jsx)(n.SettingsPageTitle,{name:"API Tokens"}),(0,t.jsx)(g.T,{title:u({id:"Settings.apiTokens.title",defaultMessage:"API Tokens"}),subtitle:u({id:"Settings.apiTokens.description",defaultMessage:"List of generated tokens to consume the API"}),primaryAction:y&&(0,t.jsx)(n.LinkButton,{"data-testid":"create-api-token-button",startIcon:(0,t.jsx)(i.Z,{}),size:"S",onClick:()=>W("willAddTokenFromList",{tokenType:A.A}),to:"/settings/api-tokens/create",children:u({id:"Settings.apiTokens.create",defaultMessage:"Create new API Token"})})}),(0,t.jsxs)(j.D,{children:[!E&&(0,t.jsx)(n.NoPermissions,{}),ie&&(0,t.jsx)(S.T,{permissions:{canRead:E,canDelete:o,canUpdate:V},headers:ne,contentType:"api-tokens",rows:K,isLoading:q,onConfirmDelete:r=>oe.mutateAsync(r),tokens:K,tokenType:A.A}),de&&(0,t.jsx)(n.NoContent,{content:{id:"Settings.apiTokens.addFirstToken",defaultMessage:"Add your first API Token"},action:(0,t.jsx)(n.LinkButton,{variant:"secondary",startIcon:(0,t.jsx)(i.Z,{}),to:"/settings/api-tokens/create",children:u({id:"Settings.apiTokens.addNewToken",defaultMessage:"Add new API Token"})})}),re&&(0,t.jsx)(n.NoContent,{content:{id:"Settings.apiTokens.emptyStateLayout",defaultMessage:"You don\u2019t have any content yet..."}})]})]})},f=()=>{const L=(0,I.useSelector)(v.s);return(0,t.jsx)(n.CheckPagePermissions,{permissions:L.settings["api-tokens"].main,children:(0,t.jsx)(m,{})})}},34390:(H,p,e)=>{e.d(p,{T:()=>U});var t=e(56940),n=e(65094),I=e(24091),v=e(84093),C=e(94684),M=e(44773),g=e(74065),j=e(66041),i=e(30956),s=e(14025),R=e(48288),O=e(82018),k=e(75937),A=e(68333),S=e(5799),Y=e(95227),b=e(19681);const N=({tokenName:a,onClickDelete:d,tokenType:c})=>{const{formatMessage:D}=(0,R.Z)(),{trackUsage:T}=(0,i.useTracking)(),[_,l]=(0,k.useState)(!1),P=()=>{l(!1),T("willDeleteToken",{tokenType:c}),d()};return(0,t.jsxs)(n.x,{paddingLeft:1,onClick:m=>m.stopPropagation(),children:[(0,t.jsx)(I.h,{onClick:()=>{l(!0)},label:D({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${a}`}),name:"delete",noBorder:!0,icon:(0,t.jsx)(A.Z,{})}),(0,t.jsx)(i.ConfirmDialog,{onToggleDialog:()=>l(!1),onConfirm:P,isOpen:_})]})};N.propTypes={tokenName:s.string.isRequired,onClickDelete:s.func.isRequired,tokenType:s.string.isRequired};const G={edit:{id:"app.component.table.edit",defaultMessage:"Edit {target}"},read:{id:"app.component.table.read",defaultMessage:"Read {target}"}},z=(0,b.default)(i.Link)`
  svg {
    path {
      fill: ${({theme:a})=>a.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:a})=>a.colors.neutral800};
      }
    }
  }
`,h=({tokenName:a,tokenId:d,buttonType:c,children:D})=>{const{formatMessage:T}=(0,R.Z)(),{location:{pathname:_}}=(0,O.k6)();return(0,t.jsx)(z,{to:`${_}/${d}`,title:T(G[c],{target:a}),children:D})};h.propTypes={tokenName:s.string.isRequired,tokenId:s.oneOfType([s.string,s.number]).isRequired,buttonType:s.string,children:s.node.isRequired},h.defaultProps={buttonType:"edit"};const Z=({tokenName:a,tokenId:d})=>(0,t.jsx)(h,{tokenName:a,tokenId:d,buttonType:"read",children:(0,t.jsx)(S.Z,{})});Z.propTypes={tokenName:s.string.isRequired,tokenId:s.oneOfType([s.string,s.number]).isRequired};const F=({tokenName:a,tokenId:d})=>(0,t.jsx)(h,{tokenName:a,tokenId:d,children:(0,t.jsx)(Y.Z,{})});F.propTypes={tokenName:s.string.isRequired,tokenId:s.oneOfType([s.string,s.number]).isRequired};const U=({permissions:a,headers:d,contentType:c,isLoading:D,tokens:T,onConfirmDelete:_,tokenType:l})=>{const{canDelete:P,canUpdate:m,canRead:f}=a;return(0,t.jsx)(i.DynamicTable,{headers:d,contentType:c,rows:T,withBulkActions:P||m||f,isLoading:D,onConfirmDelete:_,children:(0,t.jsx)(B,{tokenType:l,permissions:a,onConfirmDelete:_})})};U.propTypes={tokens:s.array,permissions:s.shape({canRead:s.bool,canDelete:s.bool,canUpdate:s.bool}).isRequired,headers:s.arrayOf(s.shape({cellFormatter:s.func,key:s.string.isRequired,metadatas:s.shape({label:s.string.isRequired,sortable:s.bool}).isRequired,name:s.string.isRequired})),contentType:s.string.isRequired,isLoading:s.bool,onConfirmDelete:s.func,tokenType:s.string.isRequired},U.defaultProps={tokens:[],headers:[],isLoading:!1,onConfirmDelete(){}};const B=({tokenType:a,permissions:d,rows:c,withBulkActions:D,onConfirmDelete:T})=>{const{canDelete:_,canUpdate:l,canRead:P}=d,[{query:m}]=(0,i.useQueryParams)(),{formatMessage:f}=(0,R.Z)(),[,L]=m?m.sort.split(":"):"ASC",{push:u,location:{pathname:x}}=(0,O.k6)(),{trackUsage:$}=(0,i.useTracking)(),y=c.sort((o,V)=>{const E=o.name.localeCompare(V.name);return L==="DESC"?-E:E});return(0,t.jsx)(v.p,{children:y.map(o=>(0,t.jsxs)(C.Tr,{...(0,i.onRowClick)({fn(){$("willEditTokenFromList",{tokenType:a}),u(`${x}/${o.id}`)},condition:l}),children:[(0,t.jsx)(M.Td,{maxWidth:(0,i.pxToRem)(250),children:(0,t.jsx)(g.Z,{textColor:"neutral800",fontWeight:"bold",ellipsis:!0,children:o.name})}),(0,t.jsx)(M.Td,{maxWidth:(0,i.pxToRem)(250),children:(0,t.jsx)(g.Z,{textColor:"neutral800",ellipsis:!0,children:o.description})}),(0,t.jsx)(M.Td,{children:(0,t.jsx)(g.Z,{textColor:"neutral800",children:(0,t.jsx)(i.RelativeTime,{timestamp:new Date(o.createdAt)})})}),(0,t.jsx)(M.Td,{children:o.lastUsedAt&&(0,t.jsx)(g.Z,{textColor:"neutral800",children:(0,t.jsx)(i.RelativeTime,{timestamp:new Date(o.lastUsedAt),customIntervals:[{unit:"hours",threshold:1,text:f({id:"Settings.apiTokens.lastHour",defaultMessage:"last hour"})}]})})}),D&&(0,t.jsx)(M.Td,{children:(0,t.jsxs)(j.k,{justifyContent:"end",children:[l&&(0,t.jsx)(F,{tokenName:o.name,tokenId:o.id}),!l&&P&&(0,t.jsx)(Z,{tokenName:o.name,tokenId:o.id}),_&&(0,t.jsx)(N,{tokenName:o.name,onClickDelete:()=>T(o.id),tokenType:a})]})})]},o.id))})};B.defaultProps={rows:[],withBulkActions:!1},B.propTypes={rows:s.array,permissions:s.shape({canRead:s.bool,canDelete:s.bool,canUpdate:s.bool}).isRequired,onConfirmDelete:s.func.isRequired,tokenType:s.string.isRequired,withBulkActions:s.bool}}}]);
