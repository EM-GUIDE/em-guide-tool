"use strict";(self.webpackChunkem_guide_app=self.webpackChunkem_guide_app||[]).push([[9220],{76769:(F,v,s)=>{s.d(v,{a:()=>R,g:()=>O});var t=s(96452),a=s(50086);function O(E){if(!E)return null;const W=Object.entries(t.W.colors).filter(([,P])=>P.toUpperCase()===E.toUpperCase()).reduce((P,[U])=>(a.S?.[U]&&(P=U),P),null);return W?{themeColorName:W,name:a.S[W]}:null}function R(){return Object.entries(a.S).map(([E,f])=>({hex:t.W.colors[E].toUpperCase(),name:f}))}},53314:(F,v,s)=>{s.d(v,{A:()=>a,S:()=>t});const t="strapi_stage",a="strapi_assignee"},99220:(F,v,s)=>{s.r(v),s.d(v,{InformationBoxEE:()=>ss});var t=s(56940),a=s(30956),O=s(34514),R=s(97371),E=s(66041),f=s(85682),W=s(64743),P=s(10798),U=s(74065),Y=s(39738),Z=s(44721),z=s(17033),w=s(48288),x=s(40829),G=s(93484),ts=s(78712),as=s(333),ns=s(71999),es=s(1205),os=s(27469),_s=s(5337),ls=s(21709),Q=s(76030),J=s(63355),e=s(53314),S=s(75937),X=s(74089),h=s(86857),K=s(50086),V=s(76769),Es=s(53604),is=s(41480),rs=s(30120),ds=s(95721),Ms=s(4549),Ds=s(45641),Os=s(28829),Ps=s(88720),gs=s(66086),ms=s(88193),Cs=s(8232),cs=s(4357),vs=s(24926),hs=s(32635),As=s(42052),Is=s(67620),Ws=s(181),Ls=s(44386),Ts=s(14113),us=s(74428),Bs=s(34374),Rs=s(51705),fs=s(18542),Us=s(35401),Ks=s(54827),ys=s(66754),js=s(16566),xs=s(22570),Ss=s(91842),Ns=s(20203),ps=s(15391),$s=s(26516),Fs=s(51046),ws=s(35554),Vs=s(49079),Hs=s(48497),Ys=s(25869),Zs=s(83523),zs=s(28768),Gs=s(96022),Qs=s(36684),Js=s(61124),Xs=s(80649),ks=s(41062),bs=s(30913),qs=s(21633),st=s(85845);function k(){const{initialData:_,layout:{uid:r},isSingleType:g,onChange:L}=(0,a.useCMEditViewDataManager)(),T=(0,G.useSelector)(J.s),{formatMessage:n}=(0,w.Z)(),{formatAPIError:u}=(0,a.useAPIErrorHandler)(),M=(0,a.useNotification)(),{put:B}=(0,a.useFetchClient)(),{allowedActions:{canReadUsers:d},isLoading:m}=(0,a.useRBAC)({readUsers:T.settings.users.read}),{users:A,isLoading:I,isError:y}=(0,Q.u)({},{enabled:!m&&d}),C=_?.[e.A]??null,c=async({value:o})=>{l.mutate({entityId:_.id,assigneeId:parseInt(o,10),uid:r})},l=(0,x.useMutation)(async({entityId:o,assigneeId:N,uid:p})=>{const i=g?"single-types":"collection-types",{data:{data:D}}=await B(`/admin/content-manager/${i}/${p}/${o}/assignee`,{data:{id:N}});return L({target:{name:e.A,value:D[e.A]}},!0),D},{onSuccess(){M({type:"success",message:{id:"content-manager.reviewWorkflows.assignee.notification.saved",defaultMessage:"Assignee updated"}})}});return(0,t.jsx)(R.g,{name:e.A,id:e.A,children:(0,t.jsx)(E.k,{direction:"column",gap:2,alignItems:"stretch",children:(0,t.jsx)(f.hQ,{clearLabel:n({id:"content-manager.reviewWorkflows.assignee.clear",defaultMessage:"Clear assignee"}),error:y&&d&&n({id:"content-manager.reviewWorkflows.assignee.error",defaultMessage:"An error occurred while fetching users"})||l.error&&u(l.error),disabled:!m&&!I&&A.length===0,name:e.A,id:e.A,value:C?C.id:null,onChange:o=>c({value:o}),onClear:()=>c({value:null}),placeholder:n({id:"content-manager.reviewWorkflows.assignee.placeholder",defaultMessage:"Select \u2026"}),label:n({id:"content-manager.reviewWorkflows.assignee.label",defaultMessage:"Assignee"}),loading:I||m||l.isLoading,children:A.map(o=>(0,t.jsx)(W.O,{value:o.id,textValue:(0,O.g)(o,n),children:(0,O.g)(o,n)},o.id))})})})}function b({id:_,layout:r}={},g={}){const{kind:L,uid:T}=r,n=L==="collectionType"?"collection-types":"single-types",{get:u}=(0,a.useFetchClient)(),{data:M,isLoading:B,refetch:d}=(0,x.useQuery)(["content-manager",n,r.uid,_,"stages"],async()=>{const{data:I}=await u(`/admin/content-manager/${n}/${T}/${_}/stages`);return I},g),m=S.useMemo(()=>M?.meta??{},[M?.meta]),A=S.useMemo(()=>M?.data??[],[M?.data]);return{meta:m,stages:A,isLoading:B,refetch:d}}function q(){const{initialData:_,layout:r,isSingleType:g,onChange:L}=(0,a.useCMEditViewDataManager)(),{put:T}=(0,a.useFetchClient)(),{formatMessage:n}=(0,w.Z)(),{formatAPIError:u}=(0,a.useAPIErrorHandler)(),M=(0,a.useNotification)(),{meta:B,stages:d,isLoading:m,refetch:A}=b({id:_.id,layout:r},{enabled:!!_?.id}),{getFeature:I}=(0,X.u)(),[y,C]=S.useState(!1),c=I("review-workflows"),l=_?.[e.S]??null,o=(0,x.useMutation)(async({entityId:i,stageId:D,uid:j})=>{const $=g?"single-types":"collection-types",{data:{data:H}}=await T(`/admin/content-manager/${$}/${j}/${i}/stage`,{data:{id:D}});return L({target:{name:e.S,value:H[e.S]}},!0),await A(),H},{onSuccess(){M({type:"success",message:{id:"content-manager.reviewWorkflows.stage.notification.saved",defaultMessage:"Review stage updated"}})}}),N=async({value:i})=>{try{c?.[K.C]&&parseInt(c[K.C],10)<B.workflowCount?C("workflow"):c?.[K.a]&&parseInt(c[K.a],10)<d.length?C("stage"):o.mutateAsync({entityId:_.id,stageId:i,uid:r.uid})}catch{}},{themeColorName:p}=l?.color?(0,V.g)(l?.color):{};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(R.g,{hint:d.length===0&&n({id:"content-manager.reviewWorkflows.stages.no-transition",defaultMessage:"You don\u2019t have the permission to update this stage."}),name:e.S,id:e.S,children:(0,t.jsxs)(E.k,{direction:"column",gap:2,alignItems:"stretch",children:[(0,t.jsx)(P.q4,{disabled:d.length===0,error:o.error&&u(o.error)||null,name:e.S,id:e.S,value:l?.id,onChange:i=>N({value:i}),label:n({id:"content-manager.reviewWorkflows.stage.label",defaultMessage:"Review stage"}),startIcon:l&&(0,t.jsx)(E.k,{as:"span",height:2,background:l?.color,borderColor:p==="neutral0"?"neutral150":"transparent",hasRadius:!0,shrink:0,width:2,marginRight:"-3px"}),customizeContent:()=>(0,t.jsxs)(E.k,{as:"span",justifyContent:"space-between",alignItems:"center",width:"100%",children:[(0,t.jsx)(U.Z,{textColor:"neutral800",ellipsis:!0,children:l?.name??""}),m?(0,t.jsx)(Y.a,{small:!0,style:{display:"flex"},"data-testid":"loader"}):null]}),children:d.map(({id:i,color:D,name:j})=>{const{themeColorName:$}=(0,V.g)(D);return(0,t.jsx)(P.ag,{startIcon:(0,t.jsx)(E.k,{height:2,background:D,borderColor:$==="neutral0"?"neutral150":"transparent",hasRadius:!0,shrink:0,width:2}),value:i,textValue:j,children:j},i)})}),(0,t.jsx)(Z.J,{}),(0,t.jsx)(z.c,{})]})}),(0,t.jsxs)(h.L,{isOpen:y==="workflow",onClose:()=>C(!1),children:[(0,t.jsx)(h.T,{children:n({id:"content-manager.reviewWorkflows.workflows.limit.title",defaultMessage:"You\u2019ve reached the limit of workflows in your plan"})}),(0,t.jsx)(h.B,{children:n({id:"content-manager.reviewWorkflows.workflows.limit.body",defaultMessage:"Delete a workflow or contact Sales to enable more workflows."})})]}),(0,t.jsxs)(h.L,{isOpen:y==="stage",onClose:()=>C(!1),children:[(0,t.jsx)(h.T,{children:n({id:"content-manager.reviewWorkflows.stages.limit.title",defaultMessage:"You have reached the limit of stages for this workflow in your plan"})}),(0,t.jsx)(h.B,{children:n({id:"content-manager.reviewWorkflows.stages.limit.body",defaultMessage:"Try deleting some stages or contact Sales to enable more stages."})})]})]})}function ss(){const{isCreatingEntry:_,layout:{options:r}}=(0,a.useCMEditViewDataManager)(),g=r?.reviewWorkflows??!1;return(0,t.jsxs)(O.I.Root,{children:[(0,t.jsx)(O.I.Title,{}),g&&!_&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(q,{}),(0,t.jsx)(k,{})]}),(0,t.jsx)(O.I.Body,{})]})}}}]);
