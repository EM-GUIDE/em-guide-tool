"use strict";(self.webpackChunkem_guide_app=self.webpackChunkem_guide_app||[]).push([[2281],{9728:(se,B,t)=>{t.d(B,{Z:()=>P});var e=t(56940),f=t(66041);const P=({startActions:T,endActions:M})=>!T&&!M?null:(0,e.jsxs)(f.k,{justifyContent:"space-between",alignItems:"flex-start",paddingBottom:4,paddingLeft:10,paddingRight:10,children:[(0,e.jsx)(f.k,{gap:2,wrap:"wrap",children:T}),(0,e.jsx)(f.k,{gap:2,shrink:0,wrap:"wrap",children:M})]})},53917:(se,B,t)=>{t.d(B,{A:()=>C});var e=t(56940),f=t(19681),P=t(65094);const T=(0,f.default)(P.x)`
  display: grid;
  grid-template-columns: ${({hasSideNav:R})=>R?"auto 1fr":"1fr"};
`,M=(0,f.default)(P.x)`
  overflow-x: hidden;
`,C=({sideNav:R,children:W})=>(0,e.jsxs)(T,{hasSideNav:Boolean(R),children:[R,(0,e.jsx)(M,{paddingBottom:10,children:W})]})},32281:(se,B,t)=>{t.r(B),t.d(B,{default:()=>ts});var e=t(56940),f=t(75937),P=t(65094),T=t(5964),M=t(66041),C=t(58400),R=t(9144),W=t(96820),Ce=t(39738),ve=t(91496),F=t(74065),je=t(78054),te=t(11674),Oe=t(44634),ye=t(90019),Ae=t(95984),Le=t(49135),Te=t(53917),ae=t(22512),Re=t(9728),Q=t(24091),Be=t(54997),Ie=t(31220),Ue=t(43669),c=t(30956),We=t(41480),y=t(48288),I=t(82018),Fe=t(47474),s=t(16348),ps=t(76318),ne=t(4549),Se=t(68333),Ke=t(14534),be=t(17478),$=t(7047),Ze=t(49745),ze=t(31941),Qe=t(39416),$e=t(56047),Ve=t(76840),ke=t(95227),V=t(19681),u=t(14025),Ge=t(24926),Ne=t(49079),oe=t(40829),hs=t(45641),ms=t(42052),Ms=t(24302),xs=t(43223);const He=(a,{pathname:o,query:r})=>{let l=[{id:null,label:{id:(0,s.g)("plugin.name"),defaultMessage:"Media Library"},href:a?(0,s.a)(o,r):void 0}];return a?.parent?.parent&&l.push([]),a?.parent&&l.push({id:a.parent.id,label:a.parent.name,href:(0,s.a)(o,r,{folder:a.parent.id,folderPath:a.parent.path})}),a&&l.push({id:a.id,label:a.name}),l},Je=a=>{const{id:o}=(0,s.u)();return(0,e.jsx)(P.x,{position:"relative",zIndex:2,children:(0,e.jsx)(T.C,{"aria-labelledby":`${o}-title`,...a})})},k=({pagination:a})=>(0,e.jsx)(P.x,{paddingTop:6,children:(0,e.jsxs)(M.k,{alignItems:"flex-end",justifyContent:"space-between",children:[(0,e.jsx)(c.PageSizeURLQuery,{}),(0,e.jsx)(c.PaginationURLQuery,{pagination:a})]})});k.defaultProps={pagination:{pageCount:0,pageSize:10,total:0}},k.propTypes={pagination:u.shape({page:u.number,pageCount:u.number,pageSize:u.number,total:u.number})};const ie=({selected:a,onSuccess:o})=>{const{formatMessage:r}=(0,y.Z)(),[l,d]=(0,f.useState)(!1),{isLoading:g,remove:_}=(0,s.b)(),p=async()=>{await _(a),o()};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(C.z,{variant:"danger-light",size:"S",startIcon:(0,e.jsx)(Se.Z,{}),onClick:()=>d(!0),children:r({id:"global.delete",defaultMessage:"Delete"})}),(0,e.jsx)(c.ConfirmDialog,{isConfirmButtonLoading:g,isOpen:l,onToggleDialog:()=>d(!1),onConfirm:p})]})};ie.propTypes={selected:u.arrayOf(s.A,s.F).isRequired,onSuccess:u.func.isRequired};const Xe=()=>{const a=(0,c.useNotification)(),o=(0,oe.useQueryClient)(),{post:r}=(0,c.useFetchClient)(),l=({destinationFolderId:_,filesAndFolders:p})=>{const E=p.reduce((h,v)=>{const{id:i,type:A}=v,m=A==="asset"?"fileIds":"folderIds";return h[m]||(h[m]=[]),h[m].push(i),h},{});return r("/upload/actions/bulk-move",{...E,destinationFolderId:_})},d=(0,oe.useMutation)(l,{onSuccess(_){const{data:{data:p}}=_;p?.files?.length>0&&(o.refetchQueries([s.p,"assets"],{active:!0}),o.refetchQueries([s.p,"asset-count"],{active:!0})),o.refetchQueries([s.p,"folders"],{active:!0}),a({type:"success",message:{id:(0,s.g)("modal.move.success-label"),defaultMessage:"Elements have been moved successfully."}})}});return{...d,move:(_,p)=>d.mutateAsync({destinationFolderId:_,filesAndFolders:p})}},G=({onClose:a,selected:o,currentFolder:r})=>{const{formatMessage:l}=(0,y.Z)(),{data:d,isLoading:g}=(0,s.c)(),{move:_}=Xe();if(!d)return null;const p=async(v,{setErrors:i})=>{try{await _(v.destination.value,o),a()}catch(A){const S=(0,c.normalizeAPIError)(A).errors.reduce((K,j)=>(K[j.values?.path?.length||"destination"]=j.defaultMessage,K),{});Ne(S)||i(S)}},E=()=>{a()};if(g)return(0,e.jsx)(R.P,{onClose:E,labelledBy:"title",children:(0,e.jsx)(W.f,{children:(0,e.jsx)(M.k,{justifyContent:"center",paddingTop:4,paddingBottom:4,children:(0,e.jsx)(Ce.a,{children:l({id:(0,s.g)("content.isLoading"),defaultMessage:"Content is loading."})})})})});const h={destination:{value:r?.id||"",label:r?.name||d[0].label}};return(0,e.jsx)(R.P,{onClose:E,labelledBy:"title",children:(0,e.jsx)(Ge.Formik,{validateOnChange:!1,onSubmit:p,initialValues:h,children:({values:v,errors:i,setFieldValue:A})=>(0,e.jsxs)(c.Form,{noValidate:!0,children:[(0,e.jsx)(ve.x,{children:(0,e.jsx)(F.Z,{fontWeight:"bold",textColor:"neutral800",as:"h2",id:"title",children:l({id:(0,s.g)("modal.folder.move.title"),defaultMessage:"Move elements to"})})}),(0,e.jsx)(W.f,{children:(0,e.jsx)(je.r,{gap:4,children:(0,e.jsx)(te.P,{xs:12,col:12,children:(0,e.jsxs)(M.k,{direction:"column",alignItems:"stretch",gap:1,children:[(0,e.jsx)(Oe.Q,{htmlFor:"folder-destination",children:l({id:(0,s.g)("form.input.label.folder-location"),defaultMessage:"Location"})}),(0,e.jsx)(s.S,{options:d,onChange:m=>{A("destination",m)},defaultValue:v.destination,name:"destination",menuPortalTarget:document.querySelector("body"),inputId:"folder-destination",error:i?.destination,ariaErrorMessage:"destination-error"}),i.destination&&(0,e.jsx)(F.Z,{variant:"pi",as:"p",id:"folder-destination-error",textColor:"danger600",children:i.destination})]})})})}),(0,e.jsx)(ye.m,{startActions:(0,e.jsx)(C.z,{onClick:E,variant:"tertiary",name:"cancel",children:l({id:"cancel",defaultMessage:"Cancel"})}),endActions:(0,e.jsx)(C.z,{type:"submit",loading:g,children:l({id:"modal.folder.move.submit",defaultMessage:"Move"})})})]})})})};G.defaultProps={currentFolder:void 0},G.propTypes={onClose:u.func.isRequired,currentFolder:s.F,selected:u.arrayOf(s.F,s.A).isRequired};const N=({selected:a,onSuccess:o,currentFolder:r})=>{const{formatMessage:l}=(0,y.Z)(),[d,g]=(0,f.useState)(!1),_=()=>{g(!1),o()};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(C.z,{variant:"secondary",size:"S",startIcon:(0,e.jsx)(Ke.Z,{}),onClick:()=>g(!0),children:l({id:"global.move",defaultMessage:"Move"})}),d&&(0,e.jsx)(G,{currentFolder:r,onClose:_,selected:a})]})};N.defaultProps={currentFolder:void 0},N.propTypes={onSuccess:u.func.isRequired,currentFolder:s.F,selected:u.arrayOf(s.A,s.F).isRequired};const H=({selected:a,onSuccess:o,currentFolder:r})=>{const{formatMessage:l}=(0,y.Z)();return(0,e.jsxs)(M.k,{gap:2,paddingBottom:5,children:[(0,e.jsx)(F.Z,{variant:"epsilon",textColor:"neutral600",children:l({id:(0,s.g)("list.assets.selected"),defaultMessage:"{numberFolders, plural, one {1 folder} other {# folders}} - {numberAssets, plural, one {1 asset} other {# assets}} selected"},{numberFolders:a.filter(({type:d})=>d==="folder").length,numberAssets:a.filter(({type:d})=>d==="asset").length})}),(0,e.jsx)(ie,{selected:a,onSuccess:o}),(0,e.jsx)(N,{currentFolder:r,selected:a,onSuccess:o})]})};H.defaultProps={currentFolder:void 0},H.propTypes={onSuccess:u.func.isRequired,currentFolder:s.F,selected:u.arrayOf(s.A,s.F).isRequired};const Ye=({isFiltering:a,canCreate:o,canRead:r})=>a?{id:"list.assets-empty.title-withSearch",defaultMessage:"There are no elements with the applied filters"}:r?o?{id:"list.assets.empty-upload",defaultMessage:"Upload your first assets..."}:{id:"list.assets.empty",defaultMessage:"Media Library is empty"}:{id:"header.actions.no-permissions",defaultMessage:"No permissions to view"},re=({canCreate:a,isFiltering:o,canRead:r,onActionClick:l})=>{const{formatMessage:d}=(0,y.Z)(),g=Ye({isFiltering:o,canCreate:a,canRead:r});return(0,e.jsx)(s.E,{icon:r?null:be.Z,action:a&&!o&&(0,e.jsx)(C.z,{variant:"secondary",startIcon:(0,e.jsx)($.Z,{}),onClick:l,children:d({id:(0,s.g)("header.actions.add-assets"),defaultMessage:"Add new assets"})}),content:d({...g,id:(0,s.g)(g.id)})})};re.propTypes={canCreate:u.bool.isRequired,canRead:u.bool.isRequired,isFiltering:u.bool.isRequired,onActionClick:u.func.isRequired};const we=()=>{const a=(0,f.useRef)(null),[o,r]=(0,f.useState)(!1),{formatMessage:l}=(0,y.Z)(),{trackUsage:d}=(0,c.useTracking)(),[{query:g},_]=(0,c.useQueryParams)(),p=g?.filters?.$and||[],E=()=>r(i=>!i),h=i=>{_({filters:{$and:i},page:1})},v=i=>{d("didFilterMediaLibraryElements",{location:"content-manager",filter:Object.keys(i[i.length-1])[0]}),_({filters:{$and:i},page:1})};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(C.z,{variant:"tertiary",ref:a,startIcon:(0,e.jsx)(Ze.Z,{}),onClick:E,size:"S",children:l({id:"app.utils.filters",defaultMessage:"Filters"})}),o&&(0,e.jsx)(s.d,{displayedFilters:s.e,filters:p,onSubmit:v,onToggle:E,source:a}),(0,e.jsx)(s.f,{appliedFilters:p,filtersSchema:s.e,onRemoveFilter:h})]})},J=({breadcrumbs:a,canCreate:o,folder:r,onToggleEditFolderDialog:l,onToggleUploadAssetDialog:d})=>{const{formatMessage:g}=(0,y.Z)(),{pathname:_}=(0,I.TH)(),[{query:p}]=(0,c.useQueryParams)(),E={...p,folder:r?.parent?.id??void 0,folderPath:r?.parent?.path??void 0};return(0,e.jsx)(Ae.T,{title:g({id:(0,s.g)("plugin.name"),defaultMessage:"Media Library"}),subtitle:a&&r&&(0,e.jsx)(s.h,{as:"nav",label:g({id:(0,s.g)("header.breadcrumbs.nav.label"),defaultMessage:"Folders navigation"}),breadcrumbs:a,currentFolderId:r?.id}),navigationAction:r&&(0,e.jsx)(Le.r,{startIcon:(0,e.jsx)(ze.Z,{}),to:`${_}?${(0,ne.stringify)(E,{encode:!1})}`,children:g({id:(0,s.g)("header.actions.folder-level-up"),defaultMessage:"Back"})}),primaryAction:o&&(0,e.jsxs)(M.k,{gap:2,children:[(0,e.jsx)(C.z,{startIcon:(0,e.jsx)($.Z,{}),variant:"secondary",onClick:l,children:g({id:(0,s.g)("header.actions.add-folder"),defaultMessage:"Add new folder"})}),(0,e.jsx)(C.z,{startIcon:(0,e.jsx)($.Z,{}),onClick:d,children:g({id:(0,s.g)("header.actions.add-assets"),defaultMessage:"Add new assets"})})]})})};J.defaultProps={breadcrumbs:!1,folder:null},J.propTypes={breadcrumbs:u.oneOfType([s.B,u.bool]),canCreate:u.bool.isRequired,folder:s.F,onToggleEditFolderDialog:u.func.isRequired,onToggleUploadAssetDialog:u.func.isRequired};const qe=(0,V.default)(P.x)`
  height: ${32/16}rem;
  display: flex;
  align-items: center;
`,le=(0,V.default)(F.Z)`
  max-width: 100%;
`,de=(0,V.default)(P.x)`
  svg {
    path {
      fill: ${({theme:a})=>a.colors.neutral500};
    }
  }
`,es=()=>{const{push:a}=(0,I.k6)(),{canRead:o,canCreate:r,canUpdate:l,canCopyLink:d,canDownload:g,isLoading:_}=(0,s.i)(),p=(0,f.useRef)(),{formatMessage:E}=(0,y.Z)(),{pathname:h}=(0,I.TH)(),{trackUsage:v}=(0,c.useTracking)(),[{query:i},A]=(0,c.useQueryParams)(),m=Boolean(i._q||i.filters),[S,K]=(0,c.usePersistentState)(s.l.view,s.v.GRID),j=S===s.v.GRID,{data:O,isLoading:as,errors:ns}=(0,s.j)({skipWhen:!o,query:i}),{data:os,isLoading:is,errors:rs}=(0,s.k)({enabled:o&&O?.pagination?.page===1&&!(0,s.m)(i),query:i}),{data:X,isLoading:ce,error:ls}=(0,s.n)(i?.folder,{enabled:o&&!!i?.folder});ls?.response?.status===404&&a(h);const b=os?.map(n=>({...n,type:"folder",folderURL:(0,s.a)(h,i,n.id),isSelectable:l}))??[],x=b?.length||0,Z=O?.results?.map(n=>({...n,type:"asset",isSelectable:l}))||[],D=Z?.length??0,ds=O?.pagination?.total,ge=ce||is||_||as,[cs,gs]=(0,f.useState)(!1),[us,ue]=(0,f.useState)(!1),[_e,Y]=(0,f.useState)(void 0),[w,Ee]=(0,f.useState)(void 0),[L,{selectOne:z,selectAll:fe}]=(0,c.useSelectionState)(["type","id"],[]),pe=L?.length>0&&L?.length!==D+x,q=()=>gs(n=>!n),he=({created:n=!1}={})=>{n&&i?.page!=="1"&&A({...i,page:1}),ue(U=>!U)},me=(n,U)=>{n.target.checked&&v("didSelectAllMediaLibraryElements"),fe(U)},Me=n=>{v("didSortMediaLibraryElements",{location:"upload",sort:n}),A({sort:n})},xe=n=>{Ee(n),ue(!0)},_s=n=>{Ee(null),he(n),p.current&&p.current.focus()},De=n=>{n===D&&O.pagination.page===O.pagination.pageCount&&O.pagination.page>1&&A({...i,page:O.pagination.page-1})},Es=()=>{fe(),De(L.length)};return(0,c.useFocusWhenNavigate)(),(0,e.jsxs)(Te.A,{children:[(0,e.jsxs)(ae.o,{"aria-busy":ge,children:[(0,e.jsx)(J,{breadcrumbs:!ce&&He(X,{pathname:h,query:i}),canCreate:r,onToggleEditFolderDialog:he,onToggleUploadAssetDialog:q,folder:X}),(0,e.jsx)(Re.Z,{startActions:(0,e.jsxs)(e.Fragment,{children:[l&&j&&(D>0||x>0)&&(0,e.jsx)(qe,{paddingLeft:2,paddingRight:2,background:"neutral0",hasRadius:!0,borderColor:"neutral200",children:(0,e.jsx)(T.C,{"aria-label":E({id:(0,s.g)("bulk.select.label"),defaultMessage:"Select all folders & assets"}),indeterminate:pe,value:(D>0||x>0)&&L.length===D+x,onChange:n=>me(n,[...Z,...b])})}),o&&j&&(0,e.jsx)(s.o,{value:i?.sort,onChangeSort:Me}),o&&(0,e.jsx)(we,{})]}),endActions:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(c.CheckPermissions,{permissions:s.P.configureView,children:(0,e.jsx)(de,{paddingTop:1,paddingBottom:1,children:(0,e.jsx)(Q.h,{forwardedAs:Fe.Link,to:{pathname:`${h}/configuration`,search:(0,ne.stringify)(i,{encode:!1})},icon:(0,e.jsx)(Qe.Z,{}),label:E({id:"app.links.configure-view",defaultMessage:"Configure the view"})})})}),(0,e.jsx)(de,{paddingTop:1,paddingBottom:1,children:(0,e.jsx)(Q.h,{icon:j?(0,e.jsx)($e.Z,{}):(0,e.jsx)(Ve.Z,{}),label:E(j?{id:(0,s.g)("view-switch.list"),defaultMessage:"List View"}:{id:(0,s.g)("view-switch.grid"),defaultMessage:"Grid View"}),onClick:()=>K(j?s.v.LIST:s.v.GRID)})}),(0,e.jsx)(c.SearchURLQuery,{label:E({id:(0,s.g)("search.label"),defaultMessage:"Search for an asset"}),trackedEvent:"didSearchMediaLibraryElements",trackedEventDetails:{location:"upload"}})]})}),(0,e.jsxs)(Be.D,{children:[L.length>0&&(0,e.jsx)(H,{currentFolder:X,selected:L,onSuccess:Es}),ge&&(0,e.jsx)(c.LoadingIndicatorPage,{}),(ns||rs)&&(0,e.jsx)(c.AnErrorOccurred,{}),x===0&&D===0&&(0,e.jsx)(re,{canCreate:r,canRead:o,isFiltering:m,onActionClick:q}),o&&!j&&(D>0||x>0)&&(0,e.jsx)(s.T,{assetCount:D,folderCount:x,indeterminate:pe,onChangeSort:Me,onChangeFolder:(n,U)=>a((0,s.a)(h,i,{folder:n,folderPath:U})),onEditAsset:Y,onEditFolder:xe,onSelectOne:z,onSelectAll:me,rows:[...b,...Z],selected:L,shouldDisableBulkSelect:!l,sortQuery:i?.sort??""}),o&&j&&(0,e.jsxs)(e.Fragment,{children:[x>0&&(0,e.jsx)(s.q,{title:(m&&D>0||!m)&&E({id:(0,s.g)("list.folders.title"),defaultMessage:"Folders ({count})"},{count:x})||"",children:b.map(n=>{const fs=!!L.filter(({type:ee})=>ee==="folder").find(ee=>ee.id===n.id),Pe=(0,s.a)(h,i,{folder:n?.id,folderPath:n?.path});return(0,e.jsx)(te.P,{col:3,children:(0,e.jsx)(s.r,{ref:w&&n.id===w.id?p:void 0,ariaLabel:n.name,id:`folder-${n.id}`,to:Pe,startAction:z&&n.isSelectable?(0,e.jsx)(Je,{"data-testid":`folder-checkbox-${n.id}`,value:fs,onChange:()=>z(n)}):null,cardActions:(0,e.jsx)(Q.h,{icon:(0,e.jsx)(ke.Z,{}),"aria-label":E({id:(0,s.g)("list.folder.edit"),defaultMessage:"Edit folder"}),onClick:()=>xe(n)}),children:(0,e.jsx)(s.s,{children:(0,e.jsx)(s.t,{to:Pe,children:(0,e.jsxs)(M.k,{as:"h2",direction:"column",alignItems:"start",maxWidth:"100%",children:[(0,e.jsxs)(le,{fontWeight:"semiBold",ellipsis:!0,children:[n.name,(0,e.jsx)(Ie.T,{children:":"})]}),(0,e.jsx)(le,{as:"span",textColor:"neutral600",variant:"pi",ellipsis:!0,children:E({id:(0,s.g)("list.folder.subtitle"),defaultMessage:"{folderCount, plural, =0 {# folder} one {# folder} other {# folders}}, {filesCount, plural, =0 {# asset} one {# asset} other {# assets}}"},{folderCount:n.children.count,filesCount:n.files.count})})]})})})})},`folder-${n.id}`)})}),D>0&&x>0&&(0,e.jsx)(P.x,{paddingTop:6,paddingBottom:4,children:(0,e.jsx)(Ue.i,{})}),D>0&&(0,e.jsx)(s.w,{assets:Z,onEditAsset:Y,onSelectAsset:z,selectedAssets:L.filter(({type:n})=>n==="asset"),title:(!m||m&&x>0)&&O?.pagination?.page===1&&E({id:(0,s.g)("list.assets.title"),defaultMessage:"Assets ({count})"},{count:ds})||""})]}),O?.pagination&&(0,e.jsx)(k,{pagination:O.pagination})]})]}),cs&&(0,e.jsx)(s.U,{onClose:q,trackedLocation:"upload",folderId:i?.folder}),us&&(0,e.jsx)(s.x,{onClose:_s,folder:w,parentFolderId:i?.folder,location:"upload"}),_e&&(0,e.jsx)(s.y,{onClose:n=>{n===null&&De(1),Y(void 0)},asset:_e,canUpdate:l,canCopyLink:d,canDownload:g,trackedLocation:"upload"})]})},ss=(0,f.lazy)(()=>t.e(5618).then(t.bind(t,35618))),ts=()=>{const{config:{isLoading:a,isError:o,data:r}}=(0,s.z)(),[{rawQuery:l},d]=(0,c.useQueryParams)(),{formatMessage:g}=(0,y.Z)(),_=g({id:(0,s.g)("plugin.name"),defaultMessage:"Media Library"});return(0,f.useEffect)(()=>{a||o||l||d({sort:r.sort,page:1,pageSize:r.pageSize})},[a,o,r,l,d]),(0,c.useFocusWhenNavigate)(),(0,e.jsxs)(ae.o,{"aria-busy":a,children:[(0,e.jsx)(We.q,{title:_}),a&&(0,e.jsx)(c.LoadingIndicatorPage,{}),l?(0,e.jsx)(f.Suspense,{fallback:(0,e.jsx)(c.LoadingIndicatorPage,{}),children:(0,e.jsxs)(I.rs,{children:[(0,e.jsx)(I.AW,{exact:!0,path:`/plugins/${s.p}`,component:es}),(0,e.jsx)(I.AW,{exact:!0,path:`/plugins/${s.p}/configuration`,render:()=>(0,e.jsx)(ss,{config:r})})]})}):null]})}}}]);
