"use strict";(self.webpackChunkem_guide_app=self.webpackChunkem_guide_app||[]).push([[1463],{53917:(ie,R,s)=>{s.d(R,{A:()=>A});var e=s(56940),E=s(19681),C=s(65094);const j=(0,E.default)(C.x)`
  display: grid;
  grid-template-columns: ${({hasSideNav:M})=>M?"auto 1fr":"1fr"};
`,U=(0,E.default)(C.x)`
  overflow-x: hidden;
`,A=({sideNav:M,children:B})=>(0,e.jsxs)(j,{hasSideNav:Boolean(M),children:[M,(0,e.jsx)(U,{paddingBottom:10,children:B})]})},21463:(ie,R,s)=>{s.r(R),s.d(R,{ProvidersPage:()=>Y,default:()=>Oe});var e=s(56940),E=s(75937),C=s(64923),j=s(87773),U=s(9144),A=s(91496),M=s(96820),B=s(66041),re=s(78054),ne=s(11674),de=s(90019),X=s(58400),oe=s(53917),le=s(22512),_e=s(95984),ue=s(54997),ce=s(19493),ge=s(2986),k=s(94684),v=s(44773),b=s(74065),me=s(31220),Ee=s(84093),pe=s(24091),r=s(30956),Pe=s(95227),he=s(28829),I=s(48288),W=s(40829),Me=s(37921),ve=s(63131),fe=s(24926),t=s(14025),n=s(58317),Te=s(49079),a=s(42052);const K=({description:o,disabled:f,intlLabel:p,error:c,name:u,onChange:O,placeholder:d,providerToEditName:P,type:m,value:_})=>{const{formatMessage:l}=(0,I.Z)(),h=u==="noName"?`${window.strapi.backendURL}/api/connect/${P}/callback`:_,D=l({id:p.id,defaultMessage:p.defaultMessage},{provider:P,...p.values}),g=o?l({id:o.id,defaultMessage:o.defaultMessage},{provider:P,...o.values}):"";if(m==="bool")return(0,e.jsx)(C.s,{"aria-label":u,checked:_,disabled:f,hint:g,label:D,name:u,offLabel:l({id:"app.components.ToggleCheckbox.off-label",defaultMessage:"Off"}),onLabel:l({id:"app.components.ToggleCheckbox.on-label",defaultMessage:"On"}),onChange:x=>{O({target:{name:u,value:x.target.checked}})}});const N=d?l({id:d.id,defaultMessage:d.defaultMessage},{...d.values}):"",q=c?l({id:c,defaultMessage:c}):"";return(0,e.jsx)(j.o,{"aria-label":u,disabled:f,error:q,label:D,name:u,onChange:O,placeholder:N,type:m,value:h})};K.defaultProps={description:null,disabled:!1,error:"",placeholder:null,value:""},K.propTypes={description:t.shape({id:t.string.isRequired,defaultMessage:t.string.isRequired,values:t.object}),disabled:t.bool,error:t.string,intlLabel:t.shape({id:t.string.isRequired,defaultMessage:t.string.isRequired,values:t.object}).isRequired,name:t.string.isRequired,onChange:t.func.isRequired,placeholder:t.shape({id:t.string.isRequired,defaultMessage:t.string.isRequired,values:t.object}),providerToEditName:t.string.isRequired,type:t.string.isRequired,value:t.oneOfType([t.bool,t.string])};const Z=({headerBreadcrumbs:o,initialData:f,isSubmiting:p,layout:c,isOpen:u,onSubmit:O,onToggle:d,providerToEditName:P})=>{const{formatMessage:m}=(0,I.Z)();return u?(0,e.jsxs)(U.P,{onClose:d,labelledBy:"title",children:[(0,e.jsx)(A.x,{children:(0,e.jsx)(Me.O,{label:o.join(", "),children:o.map((_,l,h)=>(0,e.jsx)(ve.$,{isCurrent:l===h.length-1,children:_},_))})}),(0,e.jsx)(fe.Formik,{onSubmit:_=>O(_),initialValues:f,validationSchema:c.schema,validateOnChange:!1,children:({errors:_,handleChange:l,values:h})=>(0,e.jsxs)(r.Form,{children:[(0,e.jsx)(M.f,{children:(0,e.jsx)(B.k,{direction:"column",alignItems:"stretch",gap:1,children:(0,e.jsx)(re.r,{gap:5,children:c.form.map(D=>D.map(g=>(0,e.jsx)(ne.P,{col:g.size,xs:12,children:(0,e.jsx)(K,{...g,error:_[g.name],onChange:l,value:h[g.name],providerToEditName:P})},g.name)))})})}),(0,e.jsx)(de.m,{startActions:(0,e.jsx)(X.z,{variant:"tertiary",onClick:d,type:"button",children:m({id:"app.components.Button.cancel",defaultMessage:"Cancel"})}),endActions:(0,e.jsx)(X.z,{type:"submit",loading:p,children:m({id:"global.save",defaultMessage:"Save"})})})]})})]}):null};Z.defaultProps={initialData:null,providerToEditName:null},Z.propTypes={headerBreadcrumbs:t.arrayOf(t.string).isRequired,initialData:t.object,layout:t.shape({form:t.arrayOf(t.array),schema:t.object}).isRequired,isOpen:t.bool.isRequired,isSubmiting:t.bool.isRequired,onSubmit:t.func.isRequired,onToggle:t.func.isRequired,providerToEditName:t.string};const Q={id:(0,n.g)("PopUpForm.Providers.redirectURL.front-end.label"),defaultMessage:"The redirect URL to your front-end app"},V={id:"http://www.client-app.com",defaultMessage:"http://www.client-app.com"},S={id:(0,n.g)("PopUpForm.Providers.enabled.description"),defaultMessage:"If disabled, users won't be able to use this provider."},F={id:(0,n.g)("PopUpForm.Providers.enabled.label"),defaultMessage:"Enable"},w={id:(0,n.g)("PopUpForm.Providers.key.label"),defaultMessage:"Client ID"},G={id:(0,n.g)("PopUpForm.Providers.redirectURL.label"),defaultMessage:"The redirect URL to add in your {provider} application configurations"},y={id:(0,n.g)("PopUpForm.Providers.key.placeholder"),defaultMessage:"TEXT"},J={id:(0,n.g)("PopUpForm.Providers.secret.label"),defaultMessage:"Client Secret"},z={email:{form:[[{intlLabel:F,name:"enabled",type:"bool",description:S,size:6}]],schema:a.Ry().shape({enabled:a.Xg().required(r.translatedErrors.required)})},providers:{form:[[{intlLabel:F,name:"enabled",type:"bool",description:S,size:6,validations:{required:!0}}],[{intlLabel:w,name:"key",type:"text",placeholder:y,size:12,validations:{required:!0}}],[{intlLabel:J,name:"secret",type:"text",placeholder:y,size:12,validations:{required:!0}}],[{intlLabel:Q,placeholder:V,name:"callback",type:"text",size:12,validations:{required:!0}}],[{intlLabel:G,name:"noName",type:"text",validations:{},size:12,disabled:!0}]],schema:a.Ry().shape({enabled:a.Xg().required(r.translatedErrors.required),key:a.Z_().when("enabled",{is:!0,then:a.Z_().required(r.translatedErrors.required),otherwise:a.Z_()}),secret:a.Z_().when("enabled",{is:!0,then:a.Z_().required(r.translatedErrors.required),otherwise:a.Z_()}),callback:a.Z_().when("enabled",{is:!0,then:a.Z_().required(r.translatedErrors.required),otherwise:a.Z_()})})},providersWithSubdomain:{form:[[{intlLabel:F,name:"enabled",type:"bool",description:S,size:6,validations:{required:!0}}],[{intlLabel:w,name:"key",type:"text",placeholder:y,size:12,validations:{required:!0}}],[{intlLabel:J,name:"secret",type:"text",placeholder:y,size:12,validations:{required:!0}}],[{intlLabel:{id:(0,n.g)({id:"PopUpForm.Providers.jwksurl.label"}),defaultMessage:"JWKS URL"},name:"jwksurl",type:"text",placeholder:y,size:12,validations:{required:!1}}],[{intlLabel:{id:(0,n.g)("PopUpForm.Providers.subdomain.label"),defaultMessage:"Host URI (Subdomain)"},name:"subdomain",type:"text",placeholder:{id:(0,n.g)("PopUpForm.Providers.subdomain.placeholder"),defaultMessage:"my.subdomain.com"},size:12,validations:{required:!0}}],[{intlLabel:Q,placeholder:V,name:"callback",type:"text",size:12,validations:{required:!0}}],[{intlLabel:G,name:"noName",type:"text",validations:{},size:12,disabled:!0}]],schema:a.Ry().shape({enabled:a.Xg().required(r.translatedErrors.required),key:a.Z_().when("enabled",{is:!0,then:a.Z_().required(r.translatedErrors.required),otherwise:a.Z_()}),secret:a.Z_().when("enabled",{is:!0,then:a.Z_().required(r.translatedErrors.required),otherwise:a.Z_()}),subdomain:a.Z_().when("enabled",{is:!0,then:a.Z_().required(r.translatedErrors.required),otherwise:a.Z_()}),callback:a.Z_().when("enabled",{is:!0,then:a.Z_().required(r.translatedErrors.required),otherwise:a.Z_()})})}},Y=()=>{const{formatMessage:o,locale:f}=(0,I.Z)(),p=(0,W.useQueryClient)(),{trackUsage:c}=(0,r.useTracking)(),[u,O]=E.useState(!1),[d,P]=E.useState(null),m=(0,r.useNotification)(),{lockApp:_,unlockApp:l}=(0,r.useOverlayBlocker)(),{get:h,put:D}=(0,r.useFetchClient)(),{formatAPIError:g}=(0,r.useAPIErrorHandler)(),N=(0,r.useCollator)(f,{sensitivity:"base"});(0,r.useFocusWhenNavigate)();const{isLoading:q,allowedActions:{canUpdate:x}}=(0,r.useRBAC)({update:n.P.updateProviders}),{isLoading:De,data:$}=(0,W.useQuery)(["users-permissions","get-providers"],async()=>{const{data:i}=await h("/users-permissions/providers");return i},{initialData:{}}),ee=(0,W.useMutation)(i=>D("/users-permissions/providers",i),{async onSuccess(){await p.invalidateQueries(["users-permissions","providers"]),m({type:"success",message:{id:(0,n.g)("notification.success.submit")}}),c("didEditAuthenticationProvider"),H(),l()},onError(i){m({type:"warning",message:g(i)}),l()},refetchActive:!1}),T=Object.entries($).reduce((i,[L,Le])=>{const{icon:ae,enabled:Re,subdomain:Ce}=Le;return i.push({name:L,icon:ae==="envelope"?["fas","envelope"]:["fab",ae],enabled:Re,subdomain:Ce}),i},[]).sort((i,L)=>N.compare(i.name,L.name)),be=De||q,se=E.useMemo(()=>d?!!T.find(L=>L.name===d)?.subdomain:!1,[T,d]),ye=E.useMemo(()=>d==="email"?z.email:se?z.providersWithSubdomain:z.providers,[d,se]),H=()=>{O(i=>!i)},te=i=>{x&&(P(i.name),H())},xe=async i=>{_(),c("willEditAuthenticationProvider"),ee.mutate({providers:{...$,[d]:i}})};return(0,e.jsxs)(oe.A,{children:[(0,e.jsx)(r.SettingsPageTitle,{name:o({id:(0,n.g)("HeaderNav.link.providers"),defaultMessage:"Providers"})}),(0,e.jsxs)(le.o,{children:[(0,e.jsx)(_e.T,{title:o({id:(0,n.g)("HeaderNav.link.providers"),defaultMessage:"Providers"})}),be?(0,e.jsx)(r.LoadingIndicatorPage,{}):(0,e.jsx)(ue.D,{children:(0,e.jsxs)(ce.i,{colCount:3,rowCount:T.length+1,children:[(0,e.jsx)(ge.h,{children:(0,e.jsxs)(k.Tr,{children:[(0,e.jsx)(v.Th,{children:(0,e.jsx)(b.Z,{variant:"sigma",textColor:"neutral600",children:o({id:"global.name",defaultMessage:"Name"})})}),(0,e.jsx)(v.Th,{children:(0,e.jsx)(b.Z,{variant:"sigma",textColor:"neutral600",children:o({id:(0,n.g)("Providers.status"),defaultMessage:"Status"})})}),(0,e.jsx)(v.Th,{children:(0,e.jsx)(b.Z,{variant:"sigma",children:(0,e.jsx)(me.T,{children:o({id:"global.settings",defaultMessage:"Settings"})})})})]})}),(0,e.jsx)(Ee.p,{children:T.map(i=>(0,e.jsxs)(k.Tr,{...(0,r.onRowClick)({fn:()=>te(i),condition:x}),children:[(0,e.jsx)(v.Td,{width:"45%",children:(0,e.jsx)(b.Z,{fontWeight:"semiBold",textColor:"neutral800",children:i.name})}),(0,e.jsx)(v.Td,{width:"65%",children:(0,e.jsx)(b.Z,{textColor:i.enabled?"success600":"danger600","data-testid":`enable-${i.name}`,children:i.enabled?o({id:"global.enabled",defaultMessage:"Enabled"}):o({id:"global.disabled",defaultMessage:"Disabled"})})}),(0,e.jsx)(v.Td,{...r.stopPropagation,children:x&&(0,e.jsx)(pe.h,{onClick:()=>te(i),noBorder:!0,icon:(0,e.jsx)(Pe.Z,{}),label:"Edit"})})]},i.name))})]})})]}),(0,e.jsx)(Z,{initialData:$[d],isOpen:u,isSubmiting:ee.isLoading,layout:ye,headerBreadcrumbs:[o({id:(0,n.g)("PopUpForm.header.edit.providers"),defaultMessage:"Edit Provider"}),he(d)],onToggle:H,onSubmit:xe,providerToEditName:d})]})},Oe=()=>(0,e.jsx)(r.CheckPagePermissions,{permissions:n.P.readProviders,children:(0,e.jsx)(Y,{})})}}]);
