"use strict";(self.webpackChunkem_guide_app=self.webpackChunkem_guide_app||[]).push([[1481],{51812:(X,P,e)=>{e.d(P,{f:()=>a});const a=({data:M})=>{try{return Object.keys(M).reduce((u,m)=>{const h=M[m][0];return u[m]={id:h,defaultMessage:h},u},{})}catch{return{}}}},41481:(X,P,e)=>{e.r(P),e.d(P,{SingleSignOn:()=>$,default:()=>ne});var a=e(56940),M=e(53917),u=e(22512),m=e(95984),h=e(58400),W=e(54997),S=e(66041),v=e(74065),T=e(78054),C=e(11674),j=e(64923),I=e(22884),O=e(82180),B=e(77856),n=e(30956),x=e(30454),N=e(45641),Q=e(48288),E=e(93484),H=e(98305),y=e(63355),V=e(75937),J=e(74419),w=e(71999),U=e(4357),Y=e(21709),R=e(42052),q=e(51812),ie=e(40829),le=e(21633),re=e(85845),de=e(88720),_e=e(66086),Ee=e(88193),ce=e(8232),ge=e(5337),De=e(41480),Me=e(24926),ue=e(32635),Oe=e(67620),Pe=e(4549),me=e(333),he=e(78712);const ee={fieldsToPick:[],formErrors:{},initialData:{},isLoading:!0,modifiedData:{},showHeaderButtonLoader:!1,showHeaderLoader:!0},se=(s,t)=>(0,J.default)(s,o=>{switch(t.type){case"GET_DATA_SUCCEEDED":{o.isLoading=!1,o.showHeaderLoader=!1,o.initialData=U(t.data,s.fieldsToPick),o.modifiedData=U(t.data,s.fieldsToPick);break}case"ON_CANCEL":{o.modifiedData=s.initialData,o.formErrors={};break}case"ON_CHANGE":{t.keys.includes("username")&&!t.value?Y(o.modifiedData,t.keys.split("."),null):Y(o.modifiedData,t.keys.split("."),t.value);break}case"ON_SUBMIT":{o.showHeaderButtonLoader=!0;break}case"ON_SUBMIT_SUCCEEDED":{o.initialData=U(t.data,s.fieldsToPick),o.modifiedData=U(t.data,s.fieldsToPick),o.showHeaderButtonLoader=!1;break}case"SET_ERRORS":{o.formErrors=t.errors,o.showHeaderButtonLoader=!1;break}default:return o}}),ae=async(s,t)=>{let o=null;try{await t.validate(s,{abortEarly:!1})}catch(c){c instanceof R.p8&&(o=(0,n.getYupInnerErrors)(c))}return o},te=(s,t,o)=>{const[{formErrors:c,initialData:F,isLoading:g,modifiedData:A,showHeaderButtonLoader:k,showHeaderLoader:f},l]=V.useReducer(se,{...ee,fieldsToPick:o}),r=(0,n.useNotification)(),{lockApp:b,unlockApp:p}=(0,n.useOverlayBlocker)(),{get:G,put:Z}=(0,n.useFetchClient)();return V.useEffect(()=>{(async()=>{try{const{data:{data:d}}=await G("/admin/providers/options");l({type:"GET_DATA_SUCCEEDED",data:d,fieldsToPick:o})}catch{r({type:"warning",message:{id:"notification.error"}})}})()},[]),[{formErrors:c,initialData:F,isLoading:g,modifiedData:A,showHeaderButtonLoader:k,showHeaderLoader:f},l,{handleCancel:()=>{l({type:"ON_CANCEL"})},handleChange:({target:{name:L,value:d}})=>{l({type:"ON_CHANGE",keys:L,value:d})},handleSubmit:async L=>{L.preventDefault();const d=await ae(A,s);if(l({type:"SET_ERRORS",errors:d||{}}),!d)try{b(),l({type:"ON_SUBMIT"});const _=w(A,["confirmPassword","registrationToken"]);_.roles&&(_.roles=_.roles.map(z=>z.id)),_.ssoLockedRoles&&(_.ssoLockedRoles=[...new Set(_.ssoLockedRoles)]);const{data:{data:D}}=await Z("/admin/providers/options",_);t(D),l({type:"ON_SUBMIT_SUCCEEDED",data:D}),r({type:"success",message:{id:"notification.success.saved"}})}catch(_){const D=_?.response?.payload??{data:{}};D?.data&&typeof D.data=="string"?r({type:"warning",message:D.data}):r({type:"warning",message:D.message});const z=(0,q.f)(D);l({type:"SET_ERRORS",errors:z})}finally{p()}},setField:(L,d)=>{l({type:"ON_CHANGE",keys:L,value:d})}}]},oe=R.Ry().shape({autoRegister:R.Xg().required(n.translatedErrors.required),defaultRole:R.nK().when("autoRegister",(s,t)=>s?t.required(n.translatedErrors.required):t.nullable()),ssoLockedRoles:R.IX().nullable().of(R.nK().when("ssoLockedRoles",(s,t)=>s?t.required(n.translatedErrors.required):t.nullable()))}),$=()=>{(0,n.useFocusWhenNavigate)();const{formatMessage:s}=(0,Q.Z)(),t=(0,E.useSelector)(y.s),{isLoading:o,allowedActions:{canUpdate:c,canReadRoles:F}}=(0,n.useRBAC)({...t.settings.sso,readRoles:t.settings.roles.read}),[{formErrors:g,initialData:A,isLoading:k,modifiedData:f,showHeaderButtonLoader:l},,{handleChange:r,handleSubmit:b}]=te(oe,()=>{},["autoRegister","defaultRole","ssoLockedRoles"]),{roles:p,isLoading:G}=(0,H.u)(void 0,{enabled:F}),Z=o||G||k;return(0,a.jsxs)(M.A,{children:[(0,a.jsx)(n.SettingsPageTitle,{name:"SSO"}),(0,a.jsx)(u.o,{tabIndex:-1,children:(0,a.jsxs)("form",{onSubmit:b,children:[(0,a.jsx)(m.T,{primaryAction:(0,a.jsx)(h.z,{"data-testid":"save-button",disabled:N(A,f),loading:l,startIcon:(0,a.jsx)(x.Z,{}),type:"submit",size:"L",children:s({id:"global.save",defaultMessage:"Save"})}),title:s({id:"Settings.sso.title",defaultMessage:"Single Sign-On"}),subtitle:s({id:"Settings.sso.description",defaultMessage:"Configure the settings for the Single Sign-On feature."})}),(0,a.jsx)(W.D,{children:Z?(0,a.jsx)(n.LoadingIndicatorPage,{}):(0,a.jsxs)(S.k,{direction:"column",alignItems:"stretch",gap:4,background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:[(0,a.jsx)(v.Z,{variant:"delta",as:"h2",children:s({id:"global.settings",defaultMessage:"Settings"})}),(0,a.jsxs)(T.r,{gap:4,children:[(0,a.jsx)(C.P,{col:6,m:6,s:12,children:(0,a.jsx)(j.s,{"aria-label":"autoRegister","data-testid":"autoRegister",disabled:!c,checked:f.autoRegister,hint:s({id:"Settings.sso.form.registration.description",defaultMessage:"Create new user on SSO login if no account exists"}),label:s({id:"Settings.sso.form.registration.label",defaultMessage:"Auto-registration"}),name:"autoRegister",offLabel:s({id:"app.components.ToggleCheckbox.off-label",defaultMessage:"Off"}),onLabel:s({id:"app.components.ToggleCheckbox.on-label",defaultMessage:"On"}),onChange:i=>{r({target:{name:"autoRegister",value:i.target.checked}})}})}),(0,a.jsx)(C.P,{col:6,m:6,s:12,children:(0,a.jsx)(I.P,{disabled:!c,hint:s({id:"Settings.sso.form.defaultRole.description",defaultMessage:"It will attach the new authenticated user to the selected role"}),error:g.defaultRole?s({id:g.defaultRole.id,defaultMessage:g.defaultRole.id}):"",label:s({id:"Settings.sso.form.defaultRole.label",defaultMessage:"Default role"}),name:"defaultRole",onChange:i=>{r({target:{name:"defaultRole",value:i}})},placeholder:s({id:"components.InputSelect.option.placeholder",defaultMessage:"Choose here"}),value:f.defaultRole,children:p.map(({id:i,name:K})=>(0,a.jsx)(O.W,{value:i.toString(),children:K},i))})}),(0,a.jsx)(C.P,{col:6,m:6,s:12,children:(0,a.jsx)(B.NU,{disabled:!c,hint:s({id:"Settings.sso.form.localAuthenticationLock.description",defaultMessage:"Select the roles for which you want to disable the local authentication"}),error:g.ssoLockedRoles?s({id:g.ssoLockedRoles.id,defaultMessage:g.ssoLockedRoles.id}):"",label:s({id:"Settings.sso.form.localAuthenticationLock.label",defaultMessage:"Local authentication lock-out"}),name:"ssoLockedRoles",onChange:i=>{r({target:{name:"ssoLockedRoles",value:i}})},placeholder:s({id:"components.InputSelect.option.placeholder",defaultMessage:"Choose here"}),onClear:()=>{r({target:{name:"ssoLockedRoles"}})},value:f.ssoLockedRoles||[],withTags:!0,children:p.map(({id:i,name:K})=>(0,a.jsx)(B.ML,{value:i.toString(),children:K},i))})})]})]})})]})})]})},ne=()=>{const s=(0,E.useSelector)(y.s);return(0,a.jsx)(n.CheckPagePermissions,{permissions:s.settings.sso.main,children:(0,a.jsx)($,{})})}},98305:(X,P,e)=>{e.d(P,{u:()=>h});var a=e(75937),M=e(30956),u=e(48288),m=e(40829);const h=(W={},S={})=>{const{id:v="",...T}=W,{get:C}=(0,M.useFetchClient)(),{locale:j}=(0,u.Z)(),I=(0,M.useCollator)(j,{sensitivity:"base"}),{data:O,error:B,isError:n,isLoading:x,refetch:N}=(0,m.useQuery)(["roles",v,T],async()=>{const{data:E}=await C(`/admin/roles/${v??""}`,{params:T});return E},S);return{roles:a.useMemo(()=>{let E=[];return O&&(Array.isArray(O.data)?E=O.data:E=[O.data]),[...E].sort((H,y)=>I.compare(H.name,y.name))},[O,I]),error:B,isError:n,isLoading:x,refetch:N}}}}]);
