"use strict";(self.webpackChunkem_guide_app=self.webpackChunkem_guide_app||[]).push([[9305],{89305:(N,g,s)=>{s.r(g),s.d(g,{default:()=>Q});var t=s(56940),a=s(30956),L=s(93484),h=s(82018),I=s(63355),u=s(75937),_=s(65094),r=s(66041),D=s(74065),R=s(58400),T=s(78054),O=s(11674),l=s(87773),B=s(79119),U=s(22512),f=s(95984),W=s(54997),S=s(31941),E=s(24926),v=s(48288),K=s(98305),j=s(69059),P=s(14025),F=s(42052),as=s(40829),es=s(21633),ns=s(85845),is=s(88720),os=s(66086),_s=s(88193),ds=s(8232),rs=s(5337),ls=s(4357),Es=s(41480),Ps=s(32635),Ms=s(67620),Ds=s(71999),Os=s(4549),cs=s(333),ms=s(21709),gs=s(78712),hs=s(37444),us=s(49079),Rs=s(53604),vs=s(80649),As=s(28829),Cs=s(80549),Ls=s(95721);const p=({disabled:d,role:e,values:i,errors:o,onChange:A,onBlur:c})=>{const{formatMessage:n}=(0,v.Z)();return(0,t.jsx)(_.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:(0,t.jsxs)(r.k,{direction:"column",alignItems:"stretch",gap:4,children:[(0,t.jsxs)(r.k,{justifyContent:"space-between",children:[(0,t.jsxs)(_.x,{children:[(0,t.jsx)(_.x,{children:(0,t.jsx)(D.Z,{fontWeight:"bold",children:e?e.name:n({id:"global.details",defaultMessage:"Details"})})}),(0,t.jsx)(_.x,{children:(0,t.jsx)(D.Z,{textColor:"neutral500",variant:"pi",children:e?e.description:n({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})})})]}),(0,t.jsx)(R.z,{disabled:!0,variant:"secondary",children:n({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:e.usersCount})})]}),(0,t.jsxs)(T.r,{gap:4,children:[(0,t.jsx)(O.P,{col:6,children:(0,t.jsx)(l.o,{disabled:d,name:"name",error:o.name&&n({id:o.name}),label:n({id:"global.name",defaultMessage:"Name"}),onChange:A,onBlur:c,required:!0,value:i.name||""})}),(0,t.jsx)(O.P,{col:6,children:(0,t.jsx)(B.g,{disabled:d,label:n({id:"global.description",defaultMessage:"Description"}),id:"description",error:o.name&&n({id:o.name}),onChange:A,onBlur:c,children:i.description||""})})]})]})})};p.defaultProps={disabled:!1,role:null,values:{name:"",description:""}},p.propTypes={disabled:P.bool,errors:P.object.isRequired,onBlur:P.func.isRequired,onChange:P.func.isRequired,role:P.object,values:P.object};const $=F.Ry().shape({name:F.Z_().required(a.translatedErrors.required)}),H=()=>{const d=(0,a.useNotification)(),{formatMessage:e}=(0,v.Z)(),{params:{id:i}}=(0,h.$B)("/settings/roles/:id"),{put:o}=(0,a.useFetchClient)(),[A,c]=(0,u.useState)(!1),n=(0,u.useRef)(),{lockApp:V,unlockApp:G}=(0,a.useOverlayBlocker)(),{trackUsage:J}=(0,a.useTracking)(),{formatAPIError:X}=(0,a.useAPIErrorHandler)(),{isLoading:Y,data:b}=(0,j.u)(i,{cacheTime:0}),{roles:[M={}],isLoading:x,refetch:k}=(0,K.u)({id:i},{cacheTime:0}),{permissions:w,isLoading:Z}=(0,j.a)({id:i},{cacheTime:0}),q=async C=>{try{V(),c(!0);const{permissionsToSend:m,didUpdateConditions:y}=n.current.getPermissions();await o(`/admin/roles/${i}`,C),M.code!=="strapi-super-admin"&&(await o(`/admin/roles/${i}/permissions`,{permissions:m}),y&&J("didUpdateConditions")),n.current.setFormAfterSubmit(),await k(),d({type:"success",message:{id:"notification.success.saved"}})}catch(m){d({type:"warning",message:X(m)})}finally{c(!1),G()}},z=!x&&M.code==="strapi-super-admin";return(0,t.jsxs)(U.o,{children:[(0,t.jsx)(a.SettingsPageTitle,{name:"Roles"}),(0,t.jsx)(E.Formik,{enableReinitialize:!0,initialValues:{name:M.name,description:M.description},onSubmit:q,validationSchema:$,validateOnChange:!1,children:({handleSubmit:C,values:m,errors:y,handleChange:ss,handleBlur:ts})=>(0,t.jsxs)("form",{onSubmit:C,children:[(0,t.jsx)(f.T,{primaryAction:(0,t.jsx)(r.k,{gap:2,children:(0,t.jsx)(R.z,{disabled:M.code==="strapi-super-admin",onClick:C,loading:A,size:"L",children:e({id:"global.save",defaultMessage:"Save"})})}),title:e({id:"Settings.roles.edit.title",defaultMessage:"Edit a role"}),subtitle:e({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:(0,t.jsx)(a.Link,{startIcon:(0,t.jsx)(S.Z,{}),to:"/settings/roles",children:e({id:"global.back",defaultMessage:"Back"})})}),(0,t.jsx)(W.D,{children:(0,t.jsxs)(r.k,{direction:"column",alignItems:"stretch",gap:6,children:[(0,t.jsx)(p,{isLoading:x||Z,disabled:z,errors:y,values:m,onChange:ss,onBlur:ts,role:M}),!Y&&!x&&!Z?(0,t.jsx)(_.x,{shadow:"filterShadow",hasRadius:!0,children:(0,t.jsx)(j.P,{isFormDisabled:z,permissions:w,ref:n,layout:b})}):(0,t.jsx)(_.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:(0,t.jsx)(a.LoadingIndicatorPage,{})})]})})]})})]})},Q=()=>{const d=(0,L.useSelector)(I.s),{isLoading:e,allowedActions:{canRead:i,canUpdate:o}}=(0,a.useRBAC)({read:d.settings.roles.read,update:d.settings.roles.update});return e?(0,t.jsx)(a.LoadingIndicatorPage,{}):!i&&!o?(0,t.jsx)(h.l_,{to:"/"}):(0,t.jsx)(H,{})}},98305:(N,g,s)=>{s.d(g,{u:()=>I});var t=s(75937),a=s(30956),L=s(48288),h=s(40829);const I=(u={},_={})=>{const{id:r="",...D}=u,{get:R}=(0,a.useFetchClient)(),{locale:T}=(0,L.Z)(),O=(0,a.useCollator)(T,{sensitivity:"base"}),{data:l,error:B,isError:U,isLoading:f,refetch:W}=(0,h.useQuery)(["roles",r,D],async()=>{const{data:E}=await R(`/admin/roles/${r??""}`,{params:D});return E},_);return{roles:t.useMemo(()=>{let E=[];return l&&(Array.isArray(l.data)?E=l.data:E=[l.data]),[...E].sort((v,K)=>O.compare(v.name,K.name))},[l,O]),error:B,isError:U,isLoading:f,refetch:W}}}}]);
