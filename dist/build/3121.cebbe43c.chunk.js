(self.webpackChunkem_guide_app=self.webpackChunkem_guide_app||[]).push([[3121],{80698:(m,_,s)=>{var e=s(40564);function t(o,i){var r=o==null?0:o.length;return!!r&&e(o,i,0)>-1}m.exports=t},57436:m=>{function _(s,e,t){for(var o=-1,i=s==null?0:s.length;++o<i;)if(t(e,s[o]))return!0;return!1}m.exports=_},18848:(m,_,s)=>{var e=s(47081),t=s(80698),o=s(57436),i=s(41710),r=s(130),g=s(43568),l=200;function p(y,j,D,O){var N=-1,K=t,k=!0,A=y.length,B=[],V=j.length;if(!A)return B;D&&(j=i(j,r(D))),O?(K=o,k=!1):j.length>=l&&(K=g,k=!1,j=new e(j));e:for(;++N<A;){var b=y[N],U=D==null?b:D(b);if(b=O||b!==0?b:0,k&&U===U){for(var H=V;H--;)if(j[H]===U)continue e;B.push(b)}else K(j,U,O)||B.push(b)}return B}m.exports=p},87685:(m,_,s)=>{var e=s(28422),t=s(69860),o=t(e);m.exports=o},96643:m=>{function _(s,e,t,o){for(var i=s.length,r=t+(o?1:-1);o?r--:++r<i;)if(e(s[r],r,s))return r;return-1}m.exports=_},40564:(m,_,s)=>{var e=s(96643),t=s(98386),o=s(41814);function i(r,g,l){return g===g?o(r,g,l):e(r,t,l)}m.exports=i},98386:m=>{function _(s){return s!==s}m.exports=_},48949:(m,_,s)=>{var e=s(87685),t=s(41182);function o(i,r){var g=-1,l=t(i)?Array(i.length):[];return e(i,function(p,y,j){l[++g]=r(p,y,j)}),l}m.exports=o},91959:(m,_,s)=>{var e=s(41710),t=s(64723),o=s(52536),i=s(48949),r=s(3130),g=s(130),l=s(27973),p=s(10409),y=s(28768);function j(D,O,N){O.length?O=e(O,function(A){return y(A)?function(B){return t(B,A.length===1?A[0]:A)}:A}):O=[p];var K=-1;O=e(O,g(o));var k=i(D,function(A,B,V){var b=e(O,function(U){return U(A)});return{criteria:b,index:++K,value:A}});return r(k,function(A,B){return l(A,B,N)})}m.exports=j},3130:m=>{function _(s,e){var t=s.length;for(s.sort(e);t--;)s[t]=s[t].value;return s}m.exports=_},32330:(m,_,s)=>{var e=s(24160);function t(o,i){if(o!==i){var r=o!==void 0,g=o===null,l=o===o,p=e(o),y=i!==void 0,j=i===null,D=i===i,O=e(i);if(!j&&!O&&!p&&o>i||p&&y&&D&&!j&&!O||g&&y&&D||!r&&D||!l)return 1;if(!g&&!p&&!O&&o<i||O&&r&&l&&!g&&!p||j&&r&&l||!y&&l||!D)return-1}return 0}m.exports=t},27973:(m,_,s)=>{var e=s(32330);function t(o,i,r){for(var g=-1,l=o.criteria,p=i.criteria,y=l.length,j=r.length;++g<y;){var D=e(l[g],p[g]);if(D){if(g>=j)return D;var O=r[g];return D*(O=="desc"?-1:1)}}return o.index-i.index}m.exports=t},69860:(m,_,s)=>{var e=s(41182);function t(o,i){return function(r,g){if(r==null)return r;if(!e(r))return o(r,g);for(var l=r.length,p=i?l:-1,y=Object(r);(i?p--:++p<l)&&g(y[p],p,y)!==!1;);return r}}m.exports=t},41814:m=>{function _(s,e,t){for(var o=t-1,i=s.length;++o<i;)if(s[o]===e)return o;return-1}m.exports=_},53648:(m,_,s)=>{var e=s(41710),t=s(52536),o=s(48949),i=s(28768);function r(g,l){var p=i(g)?e:o;return p(g,t(l,3))}m.exports=r},53604:(m,_,s)=>{var e=s(41342),t=s(91959),o=s(164),i=s(50455),r=o(function(g,l){if(g==null)return[];var p=l.length;return p>1&&i(g,l[0],l[1])?l=[]:p>2&&i(l[0],l[1],l[2])&&(l=[l[0]]),t(g,e(l,1),[])});m.exports=r},84995:(m,_,s)=>{var e=s(20409);function t(o){var i=o==null?0:o.length;return i?e(o,1,i):[]}m.exports=t},44386:(m,_,s)=>{var e=s(20409),t=s(82970);function o(i,r,g){return i&&i.length?(r=g||r===void 0?1:t(r),e(i,0,r<0?0:r)):[]}m.exports=o},6585:(m,_,s)=>{var e=s(18848),t=s(164),o=s(38120),i=t(function(r,g){return o(r)?e(r,g):[]});m.exports=i},9728:(m,_,s)=>{"use strict";s.d(_,{Z:()=>o});var e=s(56940),t=s(66041);const o=({startActions:i,endActions:r})=>!i&&!r?null:(0,e.jsxs)(t.k,{justifyContent:"space-between",alignItems:"flex-start",paddingBottom:4,paddingLeft:10,paddingRight:10,children:[(0,e.jsx)(t.k,{gap:2,wrap:"wrap",children:i}),(0,e.jsx)(t.k,{gap:2,shrink:0,wrap:"wrap",children:r})]})},53917:(m,_,s)=>{"use strict";s.d(_,{A:()=>g});var e=s(56940),t=s(19681),o=s(65094);const i=(0,t.default)(o.x)`
  display: grid;
  grid-template-columns: ${({hasSideNav:l})=>l?"auto 1fr":"1fr"};
`,r=(0,t.default)(o.x)`
  overflow-x: hidden;
`,g=({sideNav:l,children:p})=>(0,e.jsxs)(i,{hasSideNav:Boolean(l),children:[l,(0,e.jsx)(r,{paddingBottom:10,children:p})]})},13121:(m,_,s)=>{"use strict";s.r(_),s.d(_,{default:()=>ds});var e=s(56940),t=s(30956),o=s(82018),i=s(58317),r=s(75937),g=s(65094),l=s(66041),p=s(74065),y=s(5483),j=s(78054),D=s(11674),O=s(31220),N=s(72082),K=s(47479),k=s(53295),A=s(22512),B=s(95984),V=s(58400),b=s(54997),U=s(87773),H=s(79119),je=s(49135),De=s(84093),ne=s(94684),S=s(44773),Oe=s(24091),Ce=s(84319),ye=s(53917),Re=s(9728),Ae=s(19493),ve=s(2986),Le=s(39416),ie=s(30454),Te=s(31941),Be=s(95227),be=s(68333),Ie=s(7047),re=s(24926),W=s(48288),F=s(40829),L=s(14025),Ue=s(28829),ae=s(53604),z=s(333),Q=s(19681),oe=s(74419),J=s(49079),We=s(6585),Se=s(53648),Ke=s(84995),le=s(21709),ke=s(44386),q=s(42052);const de=(0,r.createContext)({}),ce=({children:n,value:a})=>(0,e.jsx)(de.Provider,{value:a,children:n}),ee=()=>(0,r.useContext)(de);ce.propTypes={children:L.node.isRequired,value:L.object.isRequired};function Ze(n){switch(n){case"application":return"Application";case"plugin::content-manager":return"Content manager";case"plugin::content-type-builder":return"Content types builder";case"plugin::documentation":return"Documentation";case"plugin::email":return"Email";case"plugin::i18n":return"i18n";case"plugin::upload":return"Upload";case"plugin::users-permissions":return"Users-permissions";default:return Ue(n.replace("api::","").replace("plugin::",""))}}const $e=(n,a)=>{const d=Object.keys(a).sort().map(c=>({name:c,isOpen:!1}));return{...n,collapses:d}},ue=(0,Q.css)`
  background: ${n=>n.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`,Ne=(0,Q.default)(g.x)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${n=>n.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${n=>n.isActive&&ue}
  &:hover {
    ${ue}
  }
`,Fe=Q.default.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:n})=>n.colors.neutral150};
`,ge=({subCategory:n})=>{const{formatMessage:a}=(0,W.Z)(),{onChange:d,onChangeSelectAll:c,onSelectedAction:x,selectedAction:u,modifiedData:E}=ee(),P=(0,r.useMemo)(()=>z(E,n.name,{}),[E,n]),f=(0,r.useMemo)(()=>Object.values(P).every(h=>h.enabled===!0),[P]),M=(0,r.useMemo)(()=>Object.values(P).some(h=>h.enabled===!0)&&!f,[P,f]),C=(0,r.useCallback)(({target:{name:h}})=>{c({target:{name:h,value:!f}})},[f,c]),R=(0,r.useCallback)(h=>u===h,[u]);return(0,e.jsxs)(g.x,{children:[(0,e.jsxs)(l.k,{justifyContent:"space-between",alignItems:"center",children:[(0,e.jsx)(g.x,{paddingRight:4,children:(0,e.jsx)(p.Z,{variant:"sigma",textColor:"neutral600",children:n.label})}),(0,e.jsx)(Fe,{}),(0,e.jsx)(g.x,{paddingLeft:4,children:(0,e.jsx)(y.X,{name:n.name,value:f,onValueChange:h=>C({target:{name:n.name,value:h}}),indeterminate:M,children:a({id:"app.utils.select-all",defaultMessage:"Select all"})})})]}),(0,e.jsx)(l.k,{paddingTop:6,paddingBottom:6,children:(0,e.jsx)(j.r,{gap:2,style:{flex:1},children:n.actions.map(h=>{const v=`${h.name}.enabled`;return(0,e.jsx)(D.P,{col:6,children:(0,e.jsxs)(Ne,{isActive:R(h.name),padding:2,hasRadius:!0,children:[(0,e.jsx)(y.X,{value:z(E,v,!1),name:v,onValueChange:I=>d({target:{name:v,value:I}}),children:h.label}),(0,e.jsxs)("button",{type:"button",onClick:()=>x(h.name),style:{display:"inline-flex",alignItems:"center"},children:[(0,e.jsx)(O.T,{as:"span",children:a({id:"app.utils.show-bound-route",defaultMessage:"Show bound route for {route}"},{route:h.name})}),(0,e.jsx)(Le.Z,{})]})]})},h.name)})})})]})};ge.propTypes={subCategory:L.object.isRequired};const pe=({name:n,permissions:a})=>{const d=(0,r.useMemo)(()=>ae(Object.values(a.controllers).reduce((c,x,u)=>{const E=`${n}.controllers.${Object.keys(a.controllers)[u]}`,P=ae(Object.keys(x).reduce((f,M)=>[...f,{...x[M],label:M,name:`${E}.${M}`}],[]),"label");return[...c,{actions:P,label:Object.keys(a.controllers)[u],name:E}]},[]),"label"),[n,a]);return(0,e.jsx)(g.x,{padding:6,children:d.map(c=>(0,e.jsx)(ge,{subCategory:c},c.name))})};pe.propTypes={name:L.string.isRequired,permissions:L.object.isRequired};const we={collapses:[]},Ge=(n,a)=>(0,oe.default)(n,d=>{switch(a.type){case"TOGGLE_COLLAPSE":{d.collapses=n.collapses.map((c,x)=>x===a.index?{...c,isOpen:!c.isOpen}:{...c,isOpen:!1});break}default:return d}}),Ve=()=>{const{modifiedData:n}=ee(),{formatMessage:a}=(0,W.Z)(),[{collapses:d},c]=(0,r.useReducer)(Ge,we,u=>$e(u,n)),x=u=>c({type:"TOGGLE_COLLAPSE",index:u});return(0,e.jsx)(l.k,{direction:"column",alignItems:"stretch",gap:1,children:d.map((u,E)=>(0,e.jsxs)(N.U,{expanded:u.isOpen,onToggle:()=>x(E),variant:E%2===0?"secondary":void 0,children:[(0,e.jsx)(K.B,{title:Ze(u.name),description:a({id:"users-permissions.Plugin.permissions.plugins.description",defaultMessage:"Define all allowed actions for the {name} plugin."},{name:u.name}),variant:E%2?"primary":"secondary"}),(0,e.jsx)(k.v,{children:(0,e.jsx)(pe,{permissions:n[u.name],name:u.name})})]},u.name))})},He=n=>{switch(n){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}},Qe=(0,Q.default)(g.x)`
  margin: -1px;
  border-radius: ${({theme:n})=>n.spaces[1]} 0 0 ${({theme:n})=>n.spaces[1]};
`;function se({route:n}){const{formatMessage:a}=(0,W.Z)(),{method:d,handler:c,path:x}=n,u=x?Ke(x.split("/")):[],[E="",P=""]=c?c.split("."):[],f=He(n.method);return(0,e.jsxs)(l.k,{direction:"column",alignItems:"stretch",gap:2,children:[(0,e.jsxs)(p.Z,{variant:"delta",as:"h3",children:[a({id:"users-permissions.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",(0,e.jsx)("span",{children:E}),(0,e.jsxs)(p.Z,{variant:"delta",textColor:"primary600",children:[".",P]})]}),(0,e.jsxs)(l.k,{hasRadius:!0,background:"neutral0",borderColor:"neutral200",gap:0,children:[(0,e.jsx)(Qe,{background:f.background,borderColor:f.border,padding:2,children:(0,e.jsx)(p.Z,{fontWeight:"bold",textColor:f.text,children:d})}),(0,e.jsx)(g.x,{paddingLeft:2,paddingRight:2,children:Se(u,M=>(0,e.jsxs)(p.Z,{textColor:M.includes(":")?"neutral600":"neutral900",children:["/",M]},M))})]})]})}se.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},se.propTypes={route:L.shape({handler:L.string,method:L.string,path:L.string})};const ze=()=>{const{formatMessage:n}=(0,W.Z)(),{selectedAction:a,routes:d}=ee(),c=We(a.split("."),"controllers"),x=z(d,c[0]),u=c.slice(1).join("."),E=J(x)?[]:x.filter(P=>P.handler.endsWith(u));return(0,e.jsx)(D.P,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"},children:a?(0,e.jsx)(l.k,{direction:"column",alignItems:"stretch",gap:2,children:E.map((P,f)=>(0,e.jsx)(se,{route:P},f))}):(0,e.jsxs)(l.k,{direction:"column",alignItems:"stretch",gap:2,children:[(0,e.jsx)(p.Z,{variant:"delta",as:"h3",children:n({id:"users-permissions.Policies.header.title",defaultMessage:"Advanced settings"})}),(0,e.jsx)(p.Z,{as:"p",textColor:"neutral600",children:n({id:"users-permissions.Policies.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"})})]})})},Xe=(n,a,d)=>({...n,initialData:a,modifiedData:a,routes:d}),Ye={initialData:{},modifiedData:{},routes:{},selectedAction:"",policies:[]},Je=(n,a)=>(0,oe.default)(n,d=>{switch(a.type){case"ON_CHANGE":{const c=a.keys.length,x=a.keys[c-1]==="enabled";if(a.value&&x){const u=ke(a.keys,c-1).join(".");d.selectedAction=u}le(d,["modifiedData",...a.keys],a.value);break}case"ON_CHANGE_SELECT_ALL":{const c=["modifiedData",...a.keys],x=z(n,c,{}),u=Object.keys(x).reduce((E,P)=>(E[P]={...x[P],enabled:a.value},E),{});le(d,c,u);break}case"ON_RESET":{d.modifiedData=n.initialData;break}case"ON_SUBMIT_SUCCEEDED":{d.initialData=n.modifiedData;break}case"SELECT_ACTION":{const{actionToSelect:c}=a;d.selectedAction=c===n.selectedAction?"":c;break}default:return d}}),he=(0,r.forwardRef)(({permissions:n,routes:a},d)=>{const{formatMessage:c}=(0,W.Z)(),[x,u]=(0,r.useReducer)(Je,Ye,C=>Xe(C,n,a));(0,r.useImperativeHandle)(d,()=>({getPermissions(){return{permissions:x.modifiedData}},resetForm(){u({type:"ON_RESET"})},setFormAfterSubmit(){u({type:"ON_SUBMIT_SUCCEEDED"})}}));const M={...x,onChange:({target:{name:C,value:R}})=>u({type:"ON_CHANGE",keys:C.split("."),value:R==="empty__string_value"?"":R}),onChangeSelectAll:({target:{name:C,value:R}})=>u({type:"ON_CHANGE_SELECT_ALL",keys:C.split("."),value:R}),onSelectedAction:C=>u({type:"SELECT_ACTION",actionToSelect:C})};return(0,e.jsx)(ce,{value:M,children:(0,e.jsxs)(j.r,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0",children:[(0,e.jsx)(D.P,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:(0,e.jsxs)(l.k,{direction:"column",alignItems:"stretch",gap:6,children:[(0,e.jsxs)(l.k,{direction:"column",alignItems:"stretch",gap:2,children:[(0,e.jsx)(p.Z,{variant:"delta",as:"h2",children:c({id:(0,i.g)("Plugins.header.title"),defaultMessage:"Permissions"})}),(0,e.jsx)(p.Z,{as:"p",textColor:"neutral600",children:c({id:(0,i.g)("Plugins.header.description"),defaultMessage:"Only actions bound by a route are listed below."})})]}),(0,e.jsx)(Ve,{})]})}),(0,e.jsx)(ze,{})]})})});he.propTypes={permissions:L.object.isRequired,routes:L.object.isRequired};const me=(0,r.memo)(he),xe=q.Ry().shape({name:q.Z_().required(t.translatedErrors.required),description:q.Z_().required(t.translatedErrors.required)}),qe=n=>Object.keys(n).reduce((a,d)=>{const c=n[d].controllers,x=Object.keys(c).reduce((u,E)=>(J(c[E])||(u[E]=c[E]),u),{});return J(x)||(a[d]={controllers:x}),a},{}),Ee=()=>{const n=(0,t.useNotification)(),{get:a}=(0,t.useFetchClient)(),{formatAPIError:d}=(0,t.useAPIErrorHandler)(i.g),[{data:c,isLoading:x,error:u,refetch:E},{data:P,isLoading:f,error:M,refetch:C}]=(0,F.useQueries)([{queryKey:["users-permissions","permissions"],async queryFn(){const{data:{permissions:v}}=await a("/users-permissions/permissions");return v}},{queryKey:["users-permissions","routes"],async queryFn(){const{data:{routes:v}}=await a("/users-permissions/routes");return v}}]),R=async()=>{await Promise.all([E(),C()])};(0,r.useEffect)(()=>{u&&n({type:"warning",message:d(u)})},[n,u,d]),(0,r.useEffect)(()=>{M&&n({type:"warning",message:d(M)})},[n,M,d]);const h=x||f;return{permissions:c?qe(c):{},routes:P??{},getData:R,isLoading:h}},es=()=>{const{formatMessage:n}=(0,W.Z)(),a=(0,t.useNotification)(),{goBack:d}=(0,o.k6)(),{lockApp:c,unlockApp:x}=(0,t.useOverlayBlocker)(),{isLoading:u,permissions:E,routes:P}=Ee(),{trackUsage:f}=(0,t.useTracking)(),M=r.useRef(),{post:C}=(0,t.useFetchClient)(),R=(0,F.useMutation)(v=>C("/users-permissions/roles",v),{onError(){a({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})},onSuccess(){f("didCreateRole"),a({type:"success",message:{id:(0,i.g)("Settings.roles.created"),defaultMessage:"Role created"}}),d()}}),h=async v=>{c();const I=M.current.getPermissions();await R.mutate({...v,...I,users:[]}),x()};return(0,e.jsxs)(A.o,{children:[(0,e.jsx)(t.SettingsPageTitle,{name:"Roles"}),(0,e.jsx)(re.Formik,{enableReinitialize:!0,initialValues:{name:"",description:""},onSubmit:h,validationSchema:xe,children:({handleSubmit:v,values:I,handleChange:w,errors:T})=>(0,e.jsxs)(t.Form,{noValidate:!0,onSubmit:v,children:[(0,e.jsx)(B.T,{primaryAction:!u&&(0,e.jsx)(V.z,{type:"submit",loading:R.isLoading,startIcon:(0,e.jsx)(ie.Z,{}),children:n({id:"global.save",defaultMessage:"Save"})}),title:n({id:"Settings.roles.create.title",defaultMessage:"Create a role"}),subtitle:n({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"})}),(0,e.jsx)(b.D,{children:(0,e.jsxs)(l.k,{background:"neutral0",direction:"column",alignItems:"stretch",gap:7,hasRadius:!0,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,shadow:"filterShadow",children:[(0,e.jsxs)(l.k,{direction:"column",alignItems:"stretch",children:[(0,e.jsx)(p.Z,{variant:"delta",as:"h2",children:n({id:(0,i.g)("EditPage.form.roles"),defaultMessage:"Role details"})}),(0,e.jsxs)(j.r,{gap:4,children:[(0,e.jsx)(D.P,{col:6,children:(0,e.jsx)(U.o,{name:"name",value:I.name||"",onChange:w,label:n({id:"global.name",defaultMessage:"Name"}),error:T?.name?n({id:T.name,defaultMessage:"Name is required"}):!1,required:!0})}),(0,e.jsx)(D.P,{col:6,children:(0,e.jsx)(H.g,{id:"description",value:I.description||"",onChange:w,label:n({id:"global.description",defaultMessage:"Description"}),error:T?.description?n({id:T.description,defaultMessage:"Description is required"}):!1,required:!0})})]})]}),!u&&(0,e.jsx)(me,{ref:M,permissions:E,routes:P})]})})]})})]})},ss=()=>(0,e.jsx)(t.CheckPagePermissions,{permissions:i.P.createRole,children:(0,e.jsx)(es,{})}),ts=()=>{const{formatMessage:n}=(0,W.Z)(),a=(0,t.useNotification)(),{lockApp:d,unlockApp:c}=(0,t.useOverlayBlocker)(),{params:{id:x}}=(0,o.$B)("/settings/users-permissions/roles/:id"),{get:u}=(0,t.useFetchClient)(),{isLoading:E,routes:P}=Ee(),{data:f,isLoading:M,refetch:C}=(0,F.useQuery)(["users-permissions","role",x],async()=>{const{data:{role:T}}=await u(`/users-permissions/roles/${x}`);return T}),R=r.useRef(),{put:h}=(0,t.useFetchClient)(),{formatAPIError:v}=(0,t.useAPIErrorHandler)(),I=(0,F.useMutation)(T=>h(`/users-permissions/roles/${x}`,T),{onError(T){a({type:"warning",message:v(T)})},async onSuccess(){a({type:"success",message:{id:(0,i.g)("Settings.roles.created"),defaultMessage:"Role edited"}}),await C()}}),w=async T=>{d();const Z=R.current.getPermissions();await I.mutate({...T,...Z,users:[]}),c()};return M?(0,e.jsx)(t.LoadingIndicatorPage,{}):(0,e.jsxs)(A.o,{children:[(0,e.jsx)(t.SettingsPageTitle,{name:"Roles"}),(0,e.jsx)(re.Formik,{enableReinitialize:!0,initialValues:{name:f.name,description:f.description},onSubmit:w,validationSchema:xe,children:({handleSubmit:T,values:Z,handleChange:X,errors:G})=>(0,e.jsxs)(t.Form,{noValidate:!0,onSubmit:T,children:[(0,e.jsx)(B.T,{primaryAction:!E&&(0,e.jsx)(V.z,{disabled:f.code==="strapi-super-admin",type:"submit",loading:I.isLoading,startIcon:(0,e.jsx)(ie.Z,{}),children:n({id:"global.save",defaultMessage:"Save"})}),title:f.name,subtitle:f.description,navigationAction:(0,e.jsx)(t.Link,{startIcon:(0,e.jsx)(Te.Z,{}),to:"/settings/users-permissions/roles",children:n({id:"global.back",defaultMessage:"Back"})})}),(0,e.jsx)(b.D,{children:(0,e.jsxs)(l.k,{background:"neutral0",direction:"column",alignItems:"stretch",gap:7,hasRadius:!0,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,shadow:"filterShadow",children:[(0,e.jsxs)(l.k,{direction:"column",alignItems:"stretch",gap:4,children:[(0,e.jsx)(p.Z,{variant:"delta",as:"h2",children:n({id:(0,i.g)("EditPage.form.roles"),defaultMessage:"Role details"})}),(0,e.jsxs)(j.r,{gap:4,children:[(0,e.jsx)(D.P,{col:6,children:(0,e.jsx)(U.o,{name:"name",value:Z.name||"",onChange:X,label:n({id:"global.name",defaultMessage:"Name"}),error:G?.name?n({id:G.name,defaultMessage:"Name is required"}):!1,required:!0})}),(0,e.jsx)(D.P,{col:6,children:(0,e.jsx)(H.g,{id:"description",value:Z.description||"",onChange:X,label:n({id:"global.description",defaultMessage:"Description"}),error:G?.description?n({id:G.description,defaultMessage:"Description is required"}):!1,required:!0})})]})]}),!E&&(0,e.jsx)(me,{ref:R,permissions:f.permissions,routes:P})]})})]})})]})},ns=()=>(0,e.jsx)(t.CheckPagePermissions,{permissions:i.P.updateRole,children:(0,e.jsx)(ts,{})}),is=(0,Q.default)(je.r)`
  align-items: center;
  height: ${(0,t.pxToRem)(32)};
  display: flex;
  justify-content: center;
  padding: ${({theme:n})=>`${n.spaces[2]}}`};
  width: ${(0,t.pxToRem)(32)};

  svg {
    height: ${(0,t.pxToRem)(12)};
    width: ${(0,t.pxToRem)(12)};

    path {
      fill: ${({theme:n})=>n.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:n})=>n.colors.neutral800};
      }
    }
  }
`,te=({sortedRoles:n,canDelete:a,permissions:d,setRoleToDelete:c,onDelete:x})=>{const{formatMessage:u}=(0,W.Z)(),{push:E}=(0,o.k6)(),[P,f]=x,M=h=>a&&!["public","authenticated"].includes(h.type),C=h=>{c(h),f(!P)},R=h=>{E(`/settings/users-permissions/roles/${h}`)};return(0,e.jsx)(De.p,{children:n?.map(h=>(0,e.jsxs)(ne.Tr,{...(0,t.onRowClick)({fn:()=>R(h.id)}),children:[(0,e.jsx)(S.Td,{width:"20%",children:(0,e.jsx)(p.Z,{children:h.name})}),(0,e.jsx)(S.Td,{width:"50%",children:(0,e.jsx)(p.Z,{children:h.description})}),(0,e.jsx)(S.Td,{width:"30%",children:(0,e.jsx)(p.Z,{children:u({id:"Roles.RoleRow.user-count",defaultMessage:"{number, plural, =0 {# user} one {# user} other {# users}}"},{number:h.nb_users})})}),(0,e.jsx)(S.Td,{children:(0,e.jsxs)(l.k,{justifyContent:"end",...t.stopPropagation,children:[(0,e.jsx)(t.CheckPermissions,{permissions:d.updateRole,children:(0,e.jsx)(is,{to:`/settings/users-permissions/roles/${h.id}`,"aria-label":u({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:`${h.name}`}),children:(0,e.jsx)(Be.Z,{})})}),M(h)&&(0,e.jsx)(t.CheckPermissions,{permissions:d.deleteRole,children:(0,e.jsx)(Oe.h,{onClick:()=>C(h.id),noBorder:!0,icon:(0,e.jsx)(be.Z,{}),label:u({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${h.name}`})})})]})})]},h.name))})};te.defaultProps={canDelete:!1},te.propTypes={onDelete:L.array.isRequired,permissions:L.object.isRequired,setRoleToDelete:L.func.isRequired,sortedRoles:L.array.isRequired,canDelete:L.bool};const rs=async(n,a)=>{try{const{get:d}=(0,t.getFetchClient)(),{data:c}=await d("/users-permissions/roles");return a("The roles have loaded successfully"),c}catch(d){throw n({type:"warning",message:{id:"notification.error"}}),new Error(d)}},as=async(n,a)=>{try{const{del:d}=(0,t.getFetchClient)();await d(`/users-permissions/roles/${n}`)}catch{a({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}},os=()=>{const{trackUsage:n}=(0,t.useTracking)(),{formatMessage:a,locale:d}=(0,W.Z)(),c=(0,t.useNotification)(),{notifyStatus:x}=(0,Ce.G)(),[{query:u}]=(0,t.useQueryParams)(),E=u?._q||"",[P,f]=(0,r.useState)(!1),[M,C]=(0,r.useState)(!1),[R,h]=(0,r.useState)();(0,t.useFocusWhenNavigate)();const{isLoading:v,allowedActions:{canRead:I,canDelete:w}}=(0,t.useRBAC)({create:i.P.createRole,read:i.P.readRoles,update:i.P.updateRole,delete:i.P.deleteRole}),{isLoading:T,data:{roles:Z},isFetching:X,refetch:G}=(0,F.useQuery)("get-roles",()=>rs(c,x),{initialData:{},enabled:I}),{includes:fe}=(0,t.useFilter)(d,{sensitivity:"base"}),_e=(0,t.useCollator)(d,{sensitivity:"base"}),Pe=T||X,cs=()=>{f(!P)},us={roles:{id:(0,i.g)("Roles.empty"),defaultMessage:"You don't have any roles yet."},search:{id:(0,i.g)("Roles.empty.search"),defaultMessage:"No roles match the search."}},gs=a({id:"global.roles",defaultMessage:"Roles"}),ps=(0,F.useMutation)($=>as($,c),{async onSuccess(){await G()}}),hs=async()=>{C(!0),await ps.mutateAsync(R),f(!P),C(!1)},Y=(Z||[]).filter($=>fe($.name,E)||fe($.description,E)).sort(($,Me)=>_e.compare($.name,Me.name)||_e.compare($.description,Me.description)),ms=E&&!Y.length?"search":"roles",xs=4,Es=(Z?.length||0)+1;return(0,e.jsxs)(ye.A,{children:[(0,e.jsx)(t.SettingsPageTitle,{name:gs}),(0,e.jsxs)(A.o,{"aria-busy":Pe,children:[(0,e.jsx)(B.T,{title:a({id:"global.roles",defaultMessage:"Roles"}),subtitle:a({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),primaryAction:(0,e.jsx)(t.CheckPermissions,{permissions:i.P.createRole,children:(0,e.jsx)(t.LinkButton,{to:"/settings/users-permissions/roles/new",onClick:()=>n("willCreateRole"),startIcon:(0,e.jsx)(Ie.Z,{}),size:"S",children:a({id:(0,i.g)("List.button.roles"),defaultMessage:"Add new role"})})})}),(0,e.jsx)(Re.Z,{startActions:(0,e.jsx)(t.SearchURLQuery,{label:a({id:"app.component.search.label",defaultMessage:"Search"})})}),(0,e.jsxs)(b.D,{children:[!I&&(0,e.jsx)(t.NoPermissions,{}),(Pe||v)&&(0,e.jsx)(t.LoadingIndicatorPage,{}),I&&Y&&Y?.length?(0,e.jsxs)(Ae.i,{colCount:xs,rowCount:Es,children:[(0,e.jsx)(ve.h,{children:(0,e.jsxs)(ne.Tr,{children:[(0,e.jsx)(S.Th,{children:(0,e.jsx)(p.Z,{variant:"sigma",textColor:"neutral600",children:a({id:"global.name",defaultMessage:"Name"})})}),(0,e.jsx)(S.Th,{children:(0,e.jsx)(p.Z,{variant:"sigma",textColor:"neutral600",children:a({id:"global.description",defaultMessage:"Description"})})}),(0,e.jsx)(S.Th,{children:(0,e.jsx)(p.Z,{variant:"sigma",textColor:"neutral600",children:a({id:"global.users",defaultMessage:"Users"})})}),(0,e.jsx)(S.Th,{children:(0,e.jsx)(O.T,{children:a({id:"global.actions",defaultMessage:"Actions"})})})]})}),(0,e.jsx)(te,{sortedRoles:Y,canDelete:w,permissions:i.P,setRoleToDelete:h,onDelete:[P,f]})]}):(0,e.jsx)(t.EmptyStateLayout,{content:us[ms]})]}),(0,e.jsx)(t.ConfirmDialog,{isConfirmButtonLoading:M,onConfirm:hs,onToggleDialog:cs,isOpen:P})]})]})},ls=()=>(0,e.jsx)(t.CheckPagePermissions,{permissions:i.P.accessRoles,children:(0,e.jsx)(os,{})}),ds=()=>(0,e.jsx)(t.CheckPagePermissions,{permissions:i.P.accessRoles,children:(0,e.jsxs)(o.rs,{children:[(0,e.jsx)(o.AW,{path:"/settings/users-permissions/roles/new",component:ss,exact:!0}),(0,e.jsx)(o.AW,{path:"/settings/users-permissions/roles/:id",component:ns,exact:!0}),(0,e.jsx)(o.AW,{path:"/settings/users-permissions/roles",component:ls,exact:!0}),(0,e.jsx)(o.AW,{path:"",component:t.AnErrorOccurred})]})})}}]);
