"use strict";(self.webpackChunkem_guide_app=self.webpackChunkem_guide_app||[]).push([[5646],{31819:(F,E,s)=>{s.d(E,{a:()=>g,s:()=>m});var e=s(42052),a=s(30956);const t={firstname:e.Z_().trim().required(a.translatedErrors.required),lastname:e.Z_(),email:e.Z_().email(a.translatedErrors.email).lowercase().required(a.translatedErrors.required),username:e.Z_().nullable(),password:e.Z_().min(8,a.translatedErrors.minLength).matches(/[a-z]/,"components.Input.error.contain.lowercase").matches(/[A-Z]/,"components.Input.error.contain.uppercase").matches(/\d/,"components.Input.error.contain.number"),confirmPassword:e.Z_().min(8,a.translatedErrors.minLength).oneOf([e.iH("password"),null],"components.Input.error.password.noMatch").when("password",(c,n)=>c?n.required(a.translatedErrors.required):n)},m={...t,currentPassword:e.Z_().when(["password","confirmPassword"],(c,n,M)=>c||n?M.required(a.translatedErrors.required):M),preferedLanguage:e.Z_().nullable()},d={roles:e.IX().min(1,a.translatedErrors.required).required(a.translatedErrors.required)},g=e.Ry().shape({...t,isActive:e.Xg(),...d})},51812:(F,E,s)=>{s.d(E,{f:()=>e});const e=({data:a})=>{try{return Object.keys(a).reduce((t,m)=>{const d=a[m][0];return t[m]={id:d,defaultMessage:d},t},{})}catch{return{}}}},25646:(F,E,s)=>{s.r(E),s.d(E,{default:()=>rs});var e=s(56940),a=s(75937),t=s(30956),m=s(93484),d=s(82018),g=s(63355),c=s(22512),n=s(95984),M=s(58400),o=s(54997),C=s(65094),h=s(66041),A=s(74065),T=s(78054),u=s(11674),N=s(30454),$=s(31941),Q=s(24926),R=s(333),p=s(71999),l=s(4357),I=s(14025),x=s(48288),W=s(76030),K=s(88720),P=s(51812),j=s(67259),V=s(31819),G=s(40829),J=s(21633),k=s(85845),f=s(21709),_s=s(78712),cs=s(66086),Es=s(88193),ms=s(8232),us=s(5337),gs=s(41480),Ms=s(32635),ps=s(42052),Ps=s(67620),fs=s(4549);const as=async(v,i)=>{const{put:U}=(0,t.getFetchClient)(),{data:y}=await U(`/admin/users/${v}`,i);return y.data},ns=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.username.label",defaultMessage:"Username"},name:"username",placeholder:{id:"Auth.form.username.placeholder",defaultMessage:"e.g. Kai_Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"global.password",defaultMessage:"Password"},name:"password",type:"password",size:{col:6,xs:12},autoComplete:"new-password"},{intlLabel:{id:"Auth.form.confirmPassword.label",defaultMessage:"Password confirmation"},name:"confirmPassword",type:"password",size:{col:6,xs:12},autoComplete:"new-password"}],[{intlLabel:{id:"Auth.form.active.label",defaultMessage:"Active"},name:"isActive",type:"bool",size:{col:6,xs:12}}]],w=["email","firstname","lastname","username","isActive","roles"],q=({canUpdate:v})=>{const{formatMessage:i}=(0,x.Z)(),{params:{id:U}}=(0,d.$B)("/settings/users/:id"),{push:y}=(0,d.k6)(),{setUserDisplayName:S}=(0,t.useAppInfo)(),D=(0,t.useNotification)(),{lockApp:X,unlockApp:Y}=(0,t.useOverlayBlocker)(),ss=(0,K.p)(j.M,async()=>(await s.e(8032).then(s.bind(s,8032))).MagicLinkEE);(0,t.useFocusWhenNavigate)();const{users:[Z],isLoading:os}=(0,W.u)({id:U},{cacheTime:0,onError(r){const{status:_}=r.response;_===403?(D({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}}),y("/")):D({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),is=async(r,_)=>{X();try{const O=await as(U,p(r,"confirmPassword"));D({type:"success",message:i({id:"notification.success.saved",defaultMessage:"Saved"})});const B=t.auth.getUserInfo();if(U.toString()===B.id.toString()){t.auth.setUserInfo(O);const z=R(r,"username")||(0,g.g)(r.firstname,r.lastname);S(z)}_.setValues(l(r,w))}catch(O){const B=(0,P.f)(O.response.data),z=Object.keys(B).reduce((H,L)=>(H[L]=B[L].id,H),{});_.setErrors(z),D({type:"warning",message:R(O,"response.data.error.message","notification.error")})}Y()},es=os||!ss,ds=es?{id:"app.containers.Users.EditPage.header.label-loading",defaultMessage:"Edit user"}:{id:"app.containers.Users.EditPage.header.label",defaultMessage:"Edit {name}"},b=Object.keys(l(Z,w)).reduce((r,_)=>_==="roles"?(r[_]=(Z?.roles||[]).map(({id:O})=>O),r):(r[_]=Z?.[_],r),{}),ls=b.username||(0,g.g)(b.firstname,b.lastname),ts=i(ds,{name:ls});return es?(0,e.jsxs)(c.o,{"aria-busy":"true",children:[(0,e.jsx)(t.SettingsPageTitle,{name:"Users"}),(0,e.jsx)(n.T,{primaryAction:(0,e.jsx)(M.z,{disabled:!0,startIcon:(0,e.jsx)(N.Z,{}),type:"button",size:"L",children:i({id:"global.save",defaultMessage:"Save"})}),title:ts,navigationAction:(0,e.jsx)(t.Link,{startIcon:(0,e.jsx)($.Z,{}),to:"/settings/users?pageSize=10&page=1&sort=firstname",children:i({id:"global.back",defaultMessage:"Back"})})}),(0,e.jsx)(o.D,{children:(0,e.jsx)(t.LoadingIndicatorPage,{})})]}):(0,e.jsxs)(c.o,{children:[(0,e.jsx)(t.SettingsPageTitle,{name:"Users"}),(0,e.jsx)(Q.Formik,{onSubmit:is,initialValues:b,validateOnChange:!1,validationSchema:V.a,children:({errors:r,values:_,handleChange:O,isSubmitting:B,dirty:z})=>(0,e.jsxs)(t.Form,{children:[(0,e.jsx)(n.T,{primaryAction:(0,e.jsx)(M.z,{disabled:B||!v?!0:!z,startIcon:(0,e.jsx)(N.Z,{}),loading:B,type:"submit",size:"L",children:i({id:"global.save",defaultMessage:"Save"})}),title:ts,navigationAction:(0,e.jsx)(t.Link,{startIcon:(0,e.jsx)($.Z,{}),to:"/settings/users?pageSize=10&page=1&sort=firstname",children:i({id:"global.back",defaultMessage:"Back"})})}),(0,e.jsxs)(o.D,{children:[Z?.registrationToken&&(0,e.jsx)(C.x,{paddingBottom:6,children:(0,e.jsx)(ss,{registrationToken:Z.registrationToken})}),(0,e.jsxs)(h.k,{direction:"column",alignItems:"stretch",gap:7,children:[(0,e.jsx)(C.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:(0,e.jsxs)(h.k,{direction:"column",alignItems:"stretch",gap:4,children:[(0,e.jsx)(A.Z,{variant:"delta",as:"h2",children:i({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"Details"})}),(0,e.jsx)(T.r,{gap:5,children:ns.map(H=>H.map(L=>(0,e.jsx)(u.P,{...L.size,children:(0,e.jsx)(t.GenericInput,{...L,disabled:!v,error:r[L.name],onChange:O,value:_[L.name]||""})},L.name)))})]})}),(0,e.jsx)(C.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:(0,e.jsxs)(h.k,{direction:"column",alignItems:"stretch",gap:4,children:[(0,e.jsx)(A.Z,{variant:"delta",as:"h2",children:i({id:"global.roles",defaultMessage:"User's role"})}),(0,e.jsx)(T.r,{gap:5,children:(0,e.jsx)(u.P,{col:6,xs:12,children:(0,e.jsx)(j.S,{disabled:!v,error:r.roles,onChange:O,value:_.roles})})})]})})]})]})]})})]})};q.propTypes={canUpdate:I.bool.isRequired};const rs=()=>{const v=(0,t.useNotification)(),i=(0,m.useSelector)(g.s),U=a.useMemo(()=>({read:i.settings.users.read,update:i.settings.users.update}),[i.settings.users]),{isLoading:y,allowedActions:{canRead:S,canUpdate:D}}=(0,t.useRBAC)(U),{state:X}=(0,d.TH)(),Y=X?.from??"/";return(0,a.useEffect)(()=>{y||!S&&!D&&v({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}})},[y,S,D,v]),y?(0,e.jsx)(t.LoadingIndicatorPage,{}):!S&&!D?(0,e.jsx)(d.l_,{to:Y}):(0,e.jsx)(q,{canUpdate:D})}},67259:(F,E,s)=>{s.d(E,{M:()=>T,S:()=>R,a:()=>A});var e=s(56940),a=s(14025),t=s(48288),m=s(88720),d=s(24091),g=s(22884),c=s(82180),n=s(30956),M=s(21747),o=s(69960),C=s(40829),h=s(19681);const A=({children:p,target:l})=>{const I=(0,n.useNotification)(),{formatMessage:x}=(0,t.Z)(),{copy:W}=(0,n.useClipboard)(),K=x({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),P=async()=>{await W(l)&&I({type:"info",message:{id:"notification.link-copied"}})};return(0,e.jsx)(n.ContentBox,{endAction:(0,e.jsx)(d.h,{label:K,noBorder:!0,icon:(0,e.jsx)(M.Z,{}),onClick:P}),title:l,titleEllipsis:!0,subtitle:p,icon:(0,e.jsx)("span",{style:{fontSize:32},children:"\u2709\uFE0F"}),iconBackground:"neutral100"})};A.propTypes={children:a.oneOfType([a.element,a.string]).isRequired,target:a.string.isRequired};const T=({registrationToken:p})=>{const{formatMessage:l}=(0,t.Z)(),I=`${window.location.origin}${(0,m.T)()}/auth/register?registrationToken=${p}`;return(0,e.jsx)(A,{target:I,children:l({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"})})};T.defaultProps={registrationToken:""},T.propTypes={registrationToken:a.string};const u=(0,h.keyframes)`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,N=h.default.div`
  animation: ${u} 2s infinite linear;
`,$=()=>(0,e.jsx)(N,{children:(0,e.jsx)(o.Z,{})}),Q=async()=>{const{get:p}=(0,n.getFetchClient)(),{data:l}=await p("/admin/roles");return l.data},R=({disabled:p,error:l,onChange:I,value:x})=>{const{status:W,data:K}=(0,C.useQuery)(["roles"],Q,{staleTime:5e4}),{formatMessage:P}=(0,t.Z)(),j=l?P({id:l,defaultMessage:l}):"",V=P({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),G=P({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),J=P({id:"app.components.Select.placeholder",defaultMessage:"Select"}),k=W==="loading"?(0,e.jsx)($,{}):void 0;return(0,e.jsx)(g.P,{id:"roles",disabled:p,error:j,hint:G,label:V,name:"roles",onChange:f=>{I({target:{name:"roles",value:f}})},placeholder:J,multi:!0,startIcon:k,value:x.map(f=>f.toString()),withTags:!0,required:!0,children:(K||[]).map(f=>(0,e.jsx)(c.W,{value:f.id.toString(),children:P({id:`global.${f.code}`,defaultMessage:f.name})},f.id))})};R.defaultProps={disabled:!1,error:void 0},R.propTypes={disabled:a.bool,error:a.string,onChange:a.func.isRequired,value:a.array.isRequired}},76030:(F,E,s)=>{s.d(E,{u:()=>m});var e=s(75937),a=s(30956),t=s(40829);function m(d={},g={}){const{id:c="",...n}=d,{get:M}=(0,a.useFetchClient)(),{data:o,isError:C,isLoading:h,refetch:A}=(0,t.useQuery)(["users",c,n],async()=>{const{data:{data:u}}=await M(`/admin/users/${c}`,{params:n});return u},g);return{users:e.useMemo(()=>{let u=[];return o&&("results"in o?Array.isArray(o.results)&&(u=o.results):u=[o]),u},[o]),pagination:e.useMemo(()=>(o&&"pagination"in o)??null,[o]),isLoading:h,isError:C,refetch:A}}}}]);
