"use strict";(self.webpackChunkem_guide_app=self.webpackChunkem_guide_app||[]).push([[1407],{88365:(x,p,e)=>{e.d(p,{F:()=>L});var t=e(56940),a=e(75937),P=e(65094),c=e(58400),E=e(30956),D=e(49745),u=e(14025),h=e(48288);const L=({displayedFilters:_})=>{const[C,v]=(0,a.useState)(!1),{formatMessage:f}=(0,h.Z)(),R=(0,a.useRef)(),O=()=>{v(A=>!A)};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(P.x,{paddingTop:1,paddingBottom:1,children:[(0,t.jsx)(c.z,{variant:"tertiary",ref:R,startIcon:(0,t.jsx)(D.Z,{}),onClick:O,size:"S",children:f({id:"app.utils.filters",defaultMessage:"Filters"})}),C&&(0,t.jsx)(E.FilterPopoverURLQuery,{displayedFilters:_,isVisible:C,onToggle:O,source:R})]}),(0,t.jsx)(E.FilterListURLQuery,{filtersSchema:_})]})};L.propTypes={displayedFilters:u.arrayOf(u.shape({name:u.string.isRequired,metadatas:u.shape({label:u.string}),fieldSchema:u.shape({type:u.string})})).isRequired}},71407:(x,p,e)=>{e.r(p),e.d(p,{default:()=>me});var t=e(56940),a=e(30956),P=e(93484),c=e(63355),E=e(66041),D=e(74065),u=e(39738),h=e(65094),L=e(78054),_=e(42954),C=e(9144),v=e(91496),f=e(96820),R=e(84093),O=e(94684),A=e(44773),Y=e(24091),J=e(85682),G=e(64743),X=e(53917),Z=e(54997),w=e(22512),k=e(95984),q=e(9728),j=e(48288),ee=e(88365),$=e(40829),te=e(82018),se=e(76030),ae=e(2777),ne=e(67463),i=e(14025),ie=e(46729),oe=e(5799),ue=e(75937),ge=e(21633),Ee=e(85845),ce=e(88720),pe=e(66086),De=e(88193),Me=e(8232),Pe=e(5337),Oe=e(4357),he=e(41480),Le=e(24926),fe=e(32635),ye=e(42052),Ce=e(67620),Te=e(71999),ve=e(4549),Re=e(333),xe=e(21709),Ae=e(78712);const re=({canReadAuditLogs:s,canReadUsers:l})=>{const{get:g}=(0,a.useFetchClient)(),{search:o}=(0,te.TH)(),m=(0,a.useNotification)(),[{query:d}]=(0,a.useQueryParams)(),n={keepPreviousData:!0,retry:!1,staleTime:1e3*20,onError:y=>m({type:"warning",message:y.message})},{users:r,isError:M,isLoading:T}=(0,se.u)({},{...n,enabled:l,staleTime:2*(1e3*60)}),{data:U,isLoading:W,isError:K}=(0,$.useQuery)(["auditLogs",o],async()=>{const{data:y}=await g("/admin/audit-logs",{params:d});return y},{...n,enabled:s});return{auditLogs:U,users:r,isLoading:T||W,hasError:K||M}},Q=()=>{const{formatDate:s}=(0,j.Z)();return g=>{const o=(0,ie.Z)(g),m=s(o,{dateStyle:"long"}),d=s(o,{timeStyle:"medium",hourCycle:"h24"});return`${m}, ${d}`}},V={"entry.create":"Create entry{model, select, undefined {} other { ({model})}}","entry.update":"Update entry{model, select, undefined {} other { ({model})}}","entry.delete":"Delete entry{model, select, undefined {} other { ({model})}}","entry.publish":"Publish entry{model, select, undefined {} other { ({model})}}","entry.unpublish":"Unpublish entry{model, select, undefined {} other { ({model})}}","media.create":"Create media","media.update":"Update media","media.delete":"Delete media","media-folder.create":"Create media folder","media-folder.update":"Update media folder","media-folder.delete":"Delete media folder","user.create":"Create user","user.update":"Update user","user.delete":"Delete user","admin.auth.success":"Admin login","admin.logout":"Admin logout","content-type.create":"Create content type","content-type.update":"Update content type","content-type.delete":"Delete content type","component.create":"Create component","component.update":"Update component","component.delete":"Delete component","role.create":"Create role","role.update":"Update role","role.delete":"Delete role","permission.create":"Create permission","permission.update":"Update permission","permission.delete":"Delete permission"},S=s=>V[s]||s,B=({actionLabel:s,actionName:l})=>(0,t.jsxs)(E.k,{direction:"column",alignItems:"baseline",gap:1,children:[(0,t.jsx)(D.Z,{textColor:"neutral600",variant:"sigma",children:s}),(0,t.jsx)(D.Z,{textColor:"neutral600",children:l})]});B.propTypes={actionLabel:i.string.isRequired,actionName:i.string.isRequired};const F=({status:s,data:l,formattedDate:g})=>{const{formatMessage:o}=(0,j.Z)();if(s==="loading")return(0,t.jsx)(E.k,{padding:7,justifyContent:"center",alignItems:"center",children:(0,t.jsx)(u.a,{children:"Loading content..."})});const{action:m,user:d,payload:n}=l;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h.x,{marginBottom:3,children:(0,t.jsx)(D.Z,{variant:"delta",id:"title",children:o({id:"Settings.permissions.auditLogs.details",defaultMessage:"Log Details"})})}),(0,t.jsxs)(L.r,{gap:4,gridCols:2,paddingTop:4,paddingBottom:4,paddingLeft:6,paddingRight:6,marginBottom:4,background:"neutral100",hasRadius:!0,children:[(0,t.jsx)(B,{actionLabel:o({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),actionName:o({id:`Settings.permissions.auditLogs.${m}`,defaultMessage:S(m)},{model:n?.model})}),(0,t.jsx)(B,{actionLabel:o({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"}),actionName:g}),(0,t.jsx)(B,{actionLabel:o({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),actionName:d?.displayName||"-"}),(0,t.jsx)(B,{actionLabel:o({id:"Settings.permissions.auditLogs.userId",defaultMessage:"User ID"}),actionName:d?.id.toString()||"-"})]}),(0,t.jsx)(_.V,{value:JSON.stringify(n,null,2),disabled:!0,label:o({id:"Settings.permissions.auditLogs.payload",defaultMessage:"Payload"})})]})};F.defaultProps={data:{}},F.propTypes={status:i.oneOf(["idle","loading","error","success"]).isRequired,data:i.shape({action:i.string,date:i.string,payload:i.object,user:i.object}),formattedDate:i.string.isRequired};const z=({handleClose:s,logId:l})=>{const{get:g}=(0,a.useFetchClient)(),o=(0,a.useNotification)(),m=async T=>{const{data:U}=await g(`/admin/audit-logs/${T}`);if(!U)throw new Error("Audit log not found");return U},{data:d,status:n}=(0,$.useQuery)(["audit-log",l],()=>m(l),{onError(){o({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),s()}}),r=Q(),M=d?r(d.date):"";return(0,t.jsxs)(C.P,{onClose:s,labelledBy:"title",children:[(0,t.jsx)(v.x,{children:(0,t.jsx)(ae.O,{label:M,id:"title",children:(0,t.jsx)(ne.$,{isCurrent:!0,children:M})})}),(0,t.jsx)(f.f,{children:(0,t.jsx)(F,{status:n,data:d,formattedDate:M})})]})};z.propTypes={handleClose:i.func.isRequired,logId:i.string.isRequired};const b=({pagination:s})=>(0,t.jsx)(h.x,{paddingTop:4,children:(0,t.jsxs)(E.k,{alignItems:"flex-end",justifyContent:"space-between",children:[(0,t.jsx)(a.PageSizeURLQuery,{}),(0,t.jsx)(a.PaginationURLQuery,{pagination:s})]})});b.defaultProps={pagination:{pageCount:0,pageSize:50,total:0}},b.propTypes={pagination:i.shape({page:i.number,pageCount:i.number,pageSize:i.number,total:i.number})};const N=({headers:s,rows:l,onOpenModal:g})=>{const{formatMessage:o}=(0,j.Z)(),m=Q(),d=({type:n,value:r,model:M})=>n==="date"?m(r):n==="action"?o({id:`Settings.permissions.auditLogs.${r}`,defaultMessage:S(r)},{model:M}):r||"-";return(0,t.jsx)(R.p,{children:l.map(n=>(0,t.jsxs)(O.Tr,{...(0,a.onRowClick)({fn:()=>g(n.id)}),children:[s.map(({key:r,name:M,cellFormatter:T})=>(0,t.jsx)(A.Td,{children:(0,t.jsx)(D.Z,{textColor:"neutral800",children:d({type:r,value:T?T(n[M]):n[M],model:n.payload?.model})})},r)),(0,t.jsx)(A.Td,{...a.stopPropagation,children:(0,t.jsx)(E.k,{justifyContent:"end",children:(0,t.jsx)(Y.h,{onClick:()=>g(n.id),"aria-label":o({id:"app.component.table.view",defaultMessage:"{target} details"},{target:`${n.action} action`}),noBorder:!0,icon:(0,t.jsx)(oe.Z,{})})})})]},n.id))})};N.defaultProps={rows:[]},N.propTypes={headers:i.array.isRequired,rows:i.array,onOpenModal:i.func.isRequired};const I=({value:s,options:l,onChange:g})=>{const{formatMessage:o}=(0,j.Z)(),m=o({id:"Settings.permissions.auditLogs.filter.aria-label",defaultMessage:"Search and select an option to filter"});return(0,t.jsx)(J.hQ,{"aria-label":m,value:s,onChange:g,children:l.map(({label:d,customValue:n})=>(0,t.jsx)(G.O,{value:n,children:d},n))})};I.defaultProps={value:null},I.propTypes={value:i.string,options:i.arrayOf(i.shape({label:i.string.isRequired,customValue:i.string.isRequired}).isRequired).isRequired,onChange:i.func.isRequired};const H=[{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$eq",defaultMessage:"is"},value:"$eq"},{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$ne",defaultMessage:"is not"},value:"$ne"}],de=({formatMessage:s,users:l,canReadUsers:g})=>{const o=Object.keys(V).map(d=>({label:s({id:`Settings.permissions.auditLogs.${d}`,defaultMessage:S(d)},{model:void 0}),customValue:d})),m=[{name:"action",metadatas:{customOperators:H,label:s({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),customInput:I,options:o},fieldSchema:{type:"enumeration"}},{name:"date",metadatas:{label:s({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"})},fieldSchema:{type:"datetime"}}];if(g&&l){const d=r=>r.username?r.username:r.firstname&&r.lastname?s({id:"Settings.permissions.auditLogs.user.fullname",defaultMessage:"{firstname} {lastname}"},{firstname:r.firstname,lastname:r.lastname}):r.email,n=l.map(r=>({label:d(r),customValue:r.id.toString()}));return[...m,{name:"user",metadatas:{customOperators:H,label:s({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),options:n,customInput:I},fieldSchema:{type:"relation",mainField:{name:"id"}}}]}return m},le=[{name:"action",key:"action",metadatas:{label:{id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"},sortable:!0}},{name:"date",key:"date",metadatas:{label:{id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"},sortable:!0}},{key:"user",name:"user",metadatas:{label:{id:"Settings.permissions.auditLogs.user",defaultMessage:"User"},sortable:!1},cellFormatter:s=>s?s.displayName:""}],_e=()=>{const{formatMessage:s}=(0,j.Z)(),l=(0,P.useSelector)(c.s),{allowedActions:{canRead:g,canReadUsers:o}}=(0,a.useRBAC)({...l.settings.auditLogs,readUsers:l.settings.users.read}),[{query:m},d]=(0,a.useQueryParams)(),{auditLogs:n,users:r,isLoading:M,hasError:T}=re({canReadAuditLogs:g,canReadUsers:o});(0,a.useFocusWhenNavigate)();const U=de({formatMessage:s,users:r,canReadUsers:o}),W=s({id:"global.auditLogs",defaultMessage:"Audit Logs"}),K=le.map(y=>({...y,metadatas:{...y.metadatas,label:s(y.metadatas.label)}}));return T?(0,t.jsx)(X.A,{children:(0,t.jsx)(Z.D,{children:(0,t.jsx)(h.x,{paddingTop:8,children:(0,t.jsx)(a.AnErrorOccurred,{})})})}):(0,t.jsxs)(w.o,{"aria-busy":M,children:[(0,t.jsx)(a.SettingsPageTitle,{name:W}),(0,t.jsx)(k.T,{title:W,subtitle:s({id:"Settings.permissions.auditLogs.listview.header.subtitle",defaultMessage:"Logs of all the activities that happened in your environment"})}),(0,t.jsx)(q.Z,{startActions:(0,t.jsx)(ee.F,{displayedFilters:U})}),(0,t.jsxs)(Z.D,{canRead:g,children:[(0,t.jsx)(a.DynamicTable,{contentType:"Audit logs",headers:K,rows:n?.results||[],withBulkActions:!0,isLoading:M,children:(0,t.jsx)(N,{headers:K,rows:n?.results||[],onOpenModal:y=>d({id:y})})}),(0,t.jsx)(b,{pagination:n?.pagination})]}),m?.id&&(0,t.jsx)(z,{handleClose:()=>d({id:null},"remove"),logId:m.id})]})},me=()=>{const s=(0,P.useSelector)(c.s);return(0,t.jsx)(a.CheckPagePermissions,{permissions:s.settings.auditLogs.main,children:(0,t.jsx)(_e,{})})}},76030:(x,p,e)=>{e.d(p,{u:()=>c});var t=e(75937),a=e(30956),P=e(40829);function c(E={},D={}){const{id:u="",...h}=E,{get:L}=(0,a.useFetchClient)(),{data:_,isError:C,isLoading:v,refetch:f}=(0,P.useQuery)(["users",u,h],async()=>{const{data:{data:O}}=await L(`/admin/users/${u}`,{params:h});return O},D);return{users:t.useMemo(()=>{let O=[];return _&&("results"in _?Array.isArray(_.results)&&(O=_.results):O=[_]),O},[_]),pagination:t.useMemo(()=>(_&&"pagination"in _)??null,[_]),isLoading:v,isError:C,refetch:f}}},64743:(x,p,e)=>{e.d(p,{O:()=>a});var t=e(85682);const a=t.Wx},9728:(x,p,e)=>{e.d(p,{Z:()=>P});var t=e(56940),a=e(66041);const P=({startActions:c,endActions:E})=>!c&&!E?null:(0,t.jsxs)(a.k,{justifyContent:"space-between",alignItems:"flex-start",paddingBottom:4,paddingLeft:10,paddingRight:10,children:[(0,t.jsx)(a.k,{gap:2,wrap:"wrap",children:c}),(0,t.jsx)(a.k,{gap:2,shrink:0,wrap:"wrap",children:E})]})},2777:(x,p,e)=>{e.d(p,{O:()=>L});var t=e(56940),a=e(75937),P=e(19681),c=e(65094),E=e(74065);const D=()=>(0,t.jsx)(c.x,{"aria-hidden":!0,paddingLeft:1,paddingRight:1,children:(0,t.jsx)(E.Z,{variant:"pi",textColor:"neutral500",children:"/"})});D.displayName="Divider";var u=e(66041);const h=(0,P.default)(u.k)`
  // CrumbLinks do have padding-x, because they need to have a
  // interaction effect, which mis-aligns the breadcrumbs on the left.
  // This normalizes the behavior by moving the first item to left by
  // the same amount it has inner padding
  :first-child {
    margin-left: ${({theme:_})=>`calc(-1*${_.spaces[2]})`};
  }
`,L=({label:_,children:C,...v})=>{const f=a.Children.toArray(C);return(0,t.jsx)(c.x,{"aria-label":_,...v,children:(0,t.jsx)(h,{as:"ol",children:a.Children.map(f,(R,O)=>{const A=f.length>1&&O+1<f.length;return(0,t.jsxs)(u.k,{inline:!0,as:"li",children:[R,A&&(0,t.jsx)(D,{})]})})})})};L.displayName="Breadcrumbs"},67463:(x,p,e)=>{e.d(p,{$:()=>c});var t=e(56940),a=e(65094),P=e(74065);const c=({children:E,isCurrent:D=!1,...u})=>(0,t.jsx)(a.x,{paddingLeft:2,paddingRight:2,paddingTop:1,paddingBottom:1,children:(0,t.jsx)(P.Z,{variant:"pi",textColor:"neutral800",fontWeight:D?"bold":"normal","aria-current":D,...u,children:E})});c.displayName="Crumb"}}]);
