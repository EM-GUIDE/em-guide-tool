"use strict";(self.webpackChunkem_guide_app=self.webpackChunkem_guide_app||[]).push([[2641],{42641:(Q,p,s)=>{s.r(p),s.d(p,{default:()=>y});var e=s(56940),T=s(30956),I=s(93484),u=s(63355),L=s(9606),k=s(75937),P=s(40829),K=s(21633),S=s(85845),N=s(88720),B=s(66086),a=s(88193),F=s(8232),v=s(5337),V=s(4357),Z=s(41480),U=s(24926),$=s(32635),z=s(42052),M=s(67620),c=s(71999),n=s(4549),Y=s(333),g=s(21709),A=s(78712),C=s(86067);const y=()=>{const W=(0,I.useSelector)(u.s);return(0,e.jsx)(T.CheckPagePermissions,{permissions:W.settings["transfer-tokens"].create,children:(0,e.jsx)(L.T,{})})}},9606:(Q,p,s)=>{s.d(p,{T:()=>J});var e=s(56940),T=s(75937),I=s(65094),u=s(66041),L=s(74065),k=s(78054),P=s(11674),K=s(22512),S=s(95984),N=s(58400),B=s(54997),a=s(30956),F=s(24926),v=s(48288),V=s(40829),Z=s(93484),U=s(82018),$=s(63355),z=s(51812),M=s(28366),c=s(86067),n=s(14025),Y=s(30454),g=s(42052);const A=({errors:_,onChange:d,canEditInputs:f,isCreating:o,values:E,transferToken:r})=>{const{formatMessage:m}=(0,v.Z)(),x=[{value:"push",label:{id:"Settings.transferTokens.types.push",defaultMessage:"Push"}},{value:"pull",label:{id:"Settings.transferTokens.types.pull",defaultMessage:"Pull"}},{value:"push-pull",label:{id:"Settings.transferTokens.types.push-pull",defaultMessage:"Full Access"}}];return(0,e.jsx)(I.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:(0,e.jsxs)(u.k,{direction:"column",alignItems:"stretch",gap:4,children:[(0,e.jsx)(L.Z,{variant:"delta",as:"h2",children:m({id:"global.details",defaultMessage:"Details"})}),(0,e.jsxs)(k.r,{gap:5,children:[(0,e.jsx)(P.P,{col:6,xs:12,children:(0,e.jsx)(c.T,{errors:_,values:E,canEditInputs:f,onChange:d})},"name"),(0,e.jsx)(P.P,{col:6,xs:12,children:(0,e.jsx)(c.a,{errors:_,values:E,canEditInputs:f,onChange:d})},"description"),(0,e.jsx)(P.P,{col:6,xs:12,children:(0,e.jsx)(c.L,{isCreating:o,errors:_,values:E,onChange:d,token:r})},"lifespan"),(0,e.jsx)(P.P,{col:6,xs:12,children:(0,e.jsx)(c.b,{name:"permissions",values:E,errors:_,label:{id:"Settings.tokens.form.type",defaultMessage:"Token type"},onChange:O=>{d({target:{name:"permissions",value:O}})},options:x,canEditInputs:f})},"permissions")]})]})})};A.propTypes={errors:n.shape({name:n.string,description:n.string,lifespan:n.string,type:n.string}),onChange:n.func.isRequired,canEditInputs:n.bool.isRequired,values:n.shape({name:n.string,description:n.string,lifespan:n.oneOfType([n.number,n.string]),type:n.string}).isRequired,isCreating:n.bool.isRequired,transferToken:n.shape({id:n.oneOfType([n.number,n.string]),type:n.string,lifespan:n.string,name:n.string,accessKey:n.string,permissions:n.array,description:n.string,createdAt:n.string})},A.defaultProps={errors:{},transferToken:{}};const C=({transferTokenName:_})=>{const{formatMessage:d}=(0,v.Z)();return(0,a.useFocusWhenNavigate)(),(0,e.jsxs)(K.o,{"aria-busy":"true",children:[(0,e.jsx)(a.SettingsPageTitle,{name:"Transfer Tokens"}),(0,e.jsx)(S.T,{primaryAction:(0,e.jsx)(N.z,{disabled:!0,startIcon:(0,e.jsx)(Y.Z,{}),type:"button",size:"L",children:d({id:"global.save",defaultMessage:"Save"})}),title:_||d({id:"Settings.transferTokens.createPage.title",defaultMessage:"Create Transfer Token"})}),(0,e.jsx)(B.D,{children:(0,e.jsx)(a.LoadingIndicatorPage,{})})]})};C.defaultProps={transferTokenName:null},C.propTypes={transferTokenName:n.string};const y=g.Ry().shape({name:g.Z_(a.translatedErrors.string).max(100).required(a.translatedErrors.required),description:g.Z_().nullable(),lifespan:g.Rx().integer().min(0).nullable().defined(a.translatedErrors.required),permissions:g.Z_(a.translatedErrors.string).required(a.translatedErrors.required)}),W="Name already taken",J=()=>{(0,a.useFocusWhenNavigate)();const{formatMessage:_}=(0,v.Z)(),{lockApp:d,unlockApp:f}=(0,a.useOverlayBlocker)(),o=(0,a.useNotification)(),E=(0,U.k6)(),[r,m]=(0,T.useState)(E.location.state?.transferToken.accessKey?{...E.location.state.transferToken}:null),{trackUsage:x}=(0,a.useTracking)(),O=(0,T.useRef)(x),{setCurrentStep:X}=(0,a.useGuidedTour)(),b=(0,Z.useSelector)($.s),{allowedActions:{canCreate:w,canUpdate:q,canRegenerate:ss}}=(0,a.useRBAC)(b.settings["transfer-tokens"]),{params:{id:R}}=(0,U.$B)("/settings/transfer-tokens/:id"),{get:es,post:ns,put:ts}=(0,a.useFetchClient)(),i=R==="create",{formatAPIError:G}=(0,a.useAPIErrorHandler)();(0,T.useEffect)(()=>{O.current(i?"didAddTokenFromList":"didEditTokenFromList",{tokenType:M.T})},[i]);const{status:as}=(0,V.useQuery)(["transfer-token",R],async()=>{const{data:{data:t}}=await es(`/admin/transfer/tokens/${R}`);return m({...t}),t},{enabled:!i&&!r,onError(t){t.response.data.error.details?.code==="INVALID_TOKEN_SALT"?o({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):o({type:"warning",message:G(t)})}}),rs=async(t,D)=>{O.current(i?"willCreateToken":"willEditToken",{tokenType:M.T}),d();const j=t.lifespan&&parseInt(t.lifespan,10)&&t.lifespan!=="0"?parseInt(t.lifespan,10):null,h=t.permissions.split("-");try{const{data:{data:l}}=i?await ns("/admin/transfer/tokens",{...t,lifespan:j,permissions:h}):await ts(`/admin/transfer/tokens/${R}`,{name:t.name,description:t.description,permissions:h});f(),i&&(E.replace(`/settings/transfer-tokens/${l.id}`,{transferToken:l}),X("transferTokens.success")),m({...l}),o({type:"success",message:_(i?{id:"notification.success.transfertokencreated",defaultMessage:"Transfer Token successfully created"}:{id:"notification.success.transfertokenedited",defaultMessage:"Transfer Token successfully edited"})}),O.current(i?"didCreateToken":"didEditToken",{type:r?.permissions,tokenType:M.T})}catch(l){const os=(0,z.f)(l.response.data);D.setErrors(os),l?.response?.data?.error?.message===W?o({type:"warning",message:l.response.data.message||"notification.error.tokennamenotunique"}):l?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?o({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):o({type:"warning",message:l?.response?.data?.message||"notification.error"}),f()}},H=q&&!i||w&&i;if(!i&&!r&&as!=="success")return(0,e.jsx)(C,{transferTokenName:r?.name});const is=t=>{t?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?o({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):o({type:"warning",message:G(t)})};return(0,e.jsxs)(K.o,{children:[(0,e.jsx)(a.SettingsPageTitle,{name:"Transfer Tokens"}),(0,e.jsx)(F.Formik,{validationSchema:y,validateOnChange:!1,initialValues:{name:r?.name||"",description:r?.description||"",lifespan:r?.lifespan?r.lifespan.toString():r?.lifespan,permissions:r?.permissions.join("-")},enableReinitialize:!0,onSubmit:(t,D)=>rs(t,D),children:({errors:t,handleChange:D,isSubmitting:j,values:h})=>(0,e.jsxs)(a.Form,{children:[(0,e.jsx)(c.F,{backUrl:"/settings/transfer-tokens",title:{id:"Settings.transferTokens.createPage.title",defaultMessage:"Create Transfer Token"},token:r,setToken:m,canEditInputs:H,canRegenerate:ss,isSubmitting:j,regenerateUrl:"/admin/transfer/tokens/",onErrorRegenerate:is}),(0,e.jsx)(B.D,{children:(0,e.jsxs)(u.k,{direction:"column",alignItems:"stretch",gap:6,children:[Boolean(r?.name)&&(0,e.jsx)(c.c,{token:r?.accessKey,tokenType:M.T}),(0,e.jsx)(A,{errors:t,onChange:D,canEditInputs:H,isCreating:i,values:h,transferToken:r})]})})]})})]})}}}]);
