"use strict";(self.webpackChunkem_guide_app=self.webpackChunkem_guide_app||[]).push([[2260],{32260:(es,c,s)=>{s.r(c),s.d(c,{CreatePage:()=>v,default:()=>Z});var e=s(56940),m=s(75937),u=s(22512),B=s(95984),_=s(66041),g=s(58400),T=s(54997),d=s(65094),h=s(74065),I=s(78054),C=s(11674),f=s(87773),U=s(79119),i=s(30956),W=s(31941),K=s(72234),x=s(24926),p=s(49079),j=s(48288),y=s(93484),R=s(82018),S=s(19681),$=s(63355),E=s(69059),P=s(42052),ts=s(40829),as=s(21633),is=s(85845),ns=s(88720),os=s(66086),ds=s(88193),ls=s(8232),_s=s(5337),rs=s(4357),Es=s(41480),Ps=s(32635),Ms=s(67620),Ds=s(71999),Os=s(4549),cs=s(333),ms=s(21709),gs=s(78712),hs=s(37444),Cs=s(53604),Rs=s(80649),vs=s(28829),Ls=s(80549),As=s(95721);const F=P.Ry().shape({name:P.Z_().required(i.translatedErrors.required),description:P.Z_().required(i.translatedErrors.required)}),N=S.default.div`
  border: 1px solid ${({theme:t})=>t.colors.primary200};
  background: ${({theme:t})=>t.colors.primary100};
  padding: ${({theme:t})=>`${t.spaces[2]} ${t.spaces[4]}`};
  color: ${({theme:t})=>t.colors.primary600};
  border-radius: ${({theme:t})=>t.borderRadius};
  font-size: ${12/16}rem;
  font-weight: bold;
`,v=()=>{const t=(0,R.$B)("/settings/roles/duplicate/:id"),L=(0,i.useNotification)(),{lockApp:z,unlockApp:V}=(0,i.useOverlayBlocker)(),{formatMessage:a}=(0,j.Z)(),[G,M]=(0,m.useState)(!1),{replace:H}=(0,R.k6)(),D=(0,m.useRef)(),{trackUsage:r}=(0,i.useTracking)(),{post:J,put:Q}=(0,i.useFetchClient)(),{params:l}=t??{},{isLoading:X,data:Y}=(0,E.u)(l?.id,{cacheTime:0}),{permissions:b,isLoading:k}=(0,E.a)({id:l?.id},{cacheTime:0,enabled:!!l?.id}),w=O=>{z(),M(!0),l?.id?r("willDuplicateRole"):r("willCreateNewRole"),Promise.resolve(J("/admin/roles",O)).then(async({data:n})=>{const{permissionsToSend:o}=D.current.getPermissions();return l?.id?r("didDuplicateRole"):r("didCreateNewRole"),n.data.id&&!p(o)&&await Q(`/admin/roles/${n.data.id}/permissions`,{permissions:o}),n}).then(n=>{M(!1),L({type:"success",message:{id:"Settings.roles.created",defaultMessage:"created"}}),H(`/settings/roles/${n.data.id}`)}).catch(n=>{console.error(n),M(!1),L({type:"warning",message:{id:"notification.error"}})}).finally(()=>{V()})},q=`${a({id:"Settings.roles.form.created",defaultMessage:"Created"})} ${(0,K.Z)(new Date,"PPP")}`;return(0,e.jsxs)(u.o,{children:[(0,e.jsx)(i.SettingsPageTitle,{name:"Roles"}),(0,e.jsx)(x.Formik,{initialValues:{name:"",description:q},onSubmit:w,validationSchema:F,validateOnChange:!1,children:({handleSubmit:O,values:n,errors:o,handleReset:ss,handleChange:A})=>(0,e.jsx)(i.Form,{noValidate:!0,children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(B.T,{primaryAction:(0,e.jsxs)(_.k,{gap:2,children:[(0,e.jsx)(g.z,{variant:"secondary",onClick:()=>{ss(),D.current.resetForm()},size:"L",children:a({id:"app.components.Button.reset",defaultMessage:"Reset"})}),(0,e.jsx)(g.z,{onClick:O,loading:G,size:"L",children:a({id:"global.save",defaultMessage:"Save"})})]}),title:a({id:"Settings.roles.create.title",defaultMessage:"Create a role"}),subtitle:a({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:(0,e.jsx)(i.Link,{startIcon:(0,e.jsx)(W.Z,{}),to:"/settings/roles",children:a({id:"global.back",defaultMessage:"Back"})})}),(0,e.jsx)(T.D,{children:(0,e.jsxs)(_.k,{direction:"column",alignItems:"stretch",gap:6,children:[(0,e.jsx)(d.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:(0,e.jsxs)(_.k,{direction:"column",alignItems:"stretch",gap:4,children:[(0,e.jsxs)(_.k,{justifyContent:"space-between",children:[(0,e.jsxs)(d.x,{children:[(0,e.jsx)(d.x,{children:(0,e.jsx)(h.Z,{fontWeight:"bold",children:a({id:"global.details",defaultMessage:"Details"})})}),(0,e.jsx)(d.x,{children:(0,e.jsx)(h.Z,{variant:"pi",textColor:"neutral600",children:a({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})})})]}),(0,e.jsx)(N,{children:a({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:0})})]}),(0,e.jsxs)(I.r,{gap:4,children:[(0,e.jsx)(C.P,{col:6,children:(0,e.jsx)(f.o,{name:"name",error:o.name&&a({id:o.name}),label:a({id:"global.name",defaultMessage:"Name"}),onChange:A,required:!0,value:n.name})}),(0,e.jsx)(C.P,{col:6,children:(0,e.jsx)(U.g,{label:a({id:"global.description",defaultMessage:"Description"}),id:"description",error:o.description&&a({id:o.description}),onChange:A,children:n.description})})]})]})}),!X&&!k?(0,e.jsx)(d.x,{shadow:"filterShadow",hasRadius:!0,children:(0,e.jsx)(E.P,{isFormDisabled:!1,ref:D,permissions:b,layout:Y})}):(0,e.jsx)(d.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:(0,e.jsx)(i.LoadingIndicatorPage,{})})]})})]})})})]})};function Z(){const t=(0,y.useSelector)($.s);return(0,e.jsx)(i.CheckPagePermissions,{permissions:t.settings.roles.create,children:(0,e.jsx)(v,{})})}}}]);
