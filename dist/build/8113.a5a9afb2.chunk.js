"use strict";(self.webpackChunkem_guide_app=self.webpackChunkem_guide_app||[]).push([[8113],{28366:(G,P,e)=>{e.d(P,{A:()=>t,T:()=>a});const t="api-token",a="transfer-token"},88113:(G,P,e)=>{e.r(P),e.d(P,{default:()=>L});var t=e(56940),a=e(30956),U=e(93484),I=e(63355),R=e(75937),M=e(22512),O=e(95984),K=e(54997),i=e(7047),s=e(4549),h=e(48288),C=e(40829),j=e(82018),p=e(28366),k=e(34390),H=e(21633),Q=e(85845),S=e(88720),z=e(66086),J=e(88193),A=e(8232),N=e(5337),Z=e(4357),B=e(41480),x=e(24926),n=e(32635),d=e(42052),T=e(67620),D=e(71999),u=e(333),_=e(21709),l=e(78712);const g=[{name:"name",key:"name",metadatas:{label:{id:"Settings.tokens.ListView.headers.name",defaultMessage:"Name"},sortable:!0}},{name:"description",key:"description",metadatas:{label:{id:"Settings.tokens.ListView.headers.description",defaultMessage:"Description"},sortable:!1}},{name:"createdAt",key:"createdAt",metadatas:{label:{id:"Settings.tokens.ListView.headers.createdAt",defaultMessage:"Created at"},sortable:!1}},{name:"lastUsedAt",key:"lastUsedAt",metadatas:{label:{id:"Settings.tokens.ListView.headers.lastUsedAt",defaultMessage:"Last used"},sortable:!1}}],m=()=>{(0,a.useFocusWhenNavigate)();const{formatMessage:c}=(0,h.Z)(),f=(0,a.useNotification)(),F=(0,U.useSelector)(I.s),{allowedActions:{canCreate:y,canDelete:V,canUpdate:o,canRead:E}}=(0,a.useRBAC)(F.settings["transfer-tokens"]),{push:v}=(0,j.k6)(),{trackUsage:$}=(0,a.useTracking)(),{startSection:q}=(0,a.useGuidedTour)(),X=(0,R.useRef)(q),{get:ee,del:te}=(0,a.useFetchClient)();(0,R.useEffect)(()=>{X.current&&X.current("transferTokens")},[]),(0,R.useEffect)(()=>{v({search:s.stringify({sort:"name:ASC"},{encode:!1})})},[v]);const se=g.map(r=>({...r,metadatas:{...r.metadatas,label:c(r.metadatas.label)}})),{data:W,status:Y,isFetching:ne,refetch:ae}=(0,C.useQuery)(["transfer-tokens"],async()=>{$("willAccessTokenList",{tokenType:p.T});const{data:{data:r}}=await ee("/admin/transfer/tokens");return $("didAccessTokenList",{number:r.length,tokenType:p.T}),r},{enabled:E,onError(r){r?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?f({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):f({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),w=E&&(Y!=="success"&&Y!=="error"||Y==="success"&&ne),oe=(0,C.useMutation)(async r=>{await te(`/admin/transfer/tokens/${r}`)},{async onSuccess(){await ae(["transfer-tokens"])},onError(r){r?.response?.data?.data?f({type:"warning",message:r.response.data.data}):r?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?f({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):f({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),b=W&&W?.length>0,re=E&&b,ie=E&&!b&&!y,de=E&&!b&&y;return(0,t.jsxs)(M.o,{"aria-busy":w,children:[(0,t.jsx)(a.SettingsPageTitle,{name:"Transfer Tokens"}),(0,t.jsx)(O.T,{title:c({id:"Settings.transferTokens.title",defaultMessage:"Transfer Tokens"}),subtitle:c({id:"Settings.transferTokens.description",defaultMessage:'"List of generated transfer tokens"'}),primaryAction:y?(0,t.jsx)(a.LinkButton,{"data-testid":"create-transfer-token-button",startIcon:(0,t.jsx)(i.Z,{}),size:"S",onClick:()=>$("willAddTokenFromList",{tokenType:p.T}),to:"/settings/transfer-tokens/create",children:c({id:"Settings.transferTokens.create",defaultMessage:"Create new Transfer Token"})}):void 0}),(0,t.jsxs)(K.D,{children:[!E&&(0,t.jsx)(a.NoPermissions,{}),re&&(0,t.jsx)(k.T,{permissions:{canRead:E,canDelete:V,canUpdate:o},headers:se,contentType:"trasfer-tokens",rows:W,isLoading:w,onConfirmDelete:r=>oe.mutateAsync(r),tokens:W,tokenType:p.T}),de&&(0,t.jsx)(a.NoContent,{content:{id:"Settings.transferTokens.addFirstToken",defaultMessage:"Add your first Transfer Token"},action:(0,t.jsx)(a.LinkButton,{variant:"secondary",startIcon:(0,t.jsx)(i.Z,{}),to:"/settings/transfer-tokens/create",children:c({id:"Settings.transferTokens.addNewToken",defaultMessage:"Add new Transfer Token"})})}),ie&&(0,t.jsx)(a.NoContent,{content:{id:"Settings.transferTokens.emptyStateLayout",defaultMessage:"You don\u2019t have any content yet..."}})]})]})},L=()=>{const c=(0,U.useSelector)(I.s);return(0,t.jsx)(a.CheckPagePermissions,{permissions:c.settings["transfer-tokens"].main,children:(0,t.jsx)(m,{})})}},34390:(G,P,e)=>{e.d(P,{T:()=>B});var t=e(56940),a=e(65094),U=e(24091),I=e(84093),R=e(94684),M=e(44773),O=e(74065),K=e(66041),i=e(30956),s=e(14025),h=e(48288),C=e(82018),j=e(75937),p=e(68333),k=e(5799),H=e(95227),Q=e(19681);const S=({tokenName:n,onClickDelete:d,tokenType:T})=>{const{formatMessage:D}=(0,h.Z)(),{trackUsage:u}=(0,i.useTracking)(),[_,l]=(0,j.useState)(!1),g=()=>{l(!1),u("willDeleteToken",{tokenType:T}),d()};return(0,t.jsxs)(a.x,{paddingLeft:1,onClick:m=>m.stopPropagation(),children:[(0,t.jsx)(U.h,{onClick:()=>{l(!0)},label:D({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${n}`}),name:"delete",noBorder:!0,icon:(0,t.jsx)(p.Z,{})}),(0,t.jsx)(i.ConfirmDialog,{onToggleDialog:()=>l(!1),onConfirm:g,isOpen:_})]})};S.propTypes={tokenName:s.string.isRequired,onClickDelete:s.func.isRequired,tokenType:s.string.isRequired};const z={edit:{id:"app.component.table.edit",defaultMessage:"Edit {target}"},read:{id:"app.component.table.read",defaultMessage:"Read {target}"}},J=(0,Q.default)(i.Link)`
  svg {
    path {
      fill: ${({theme:n})=>n.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:n})=>n.colors.neutral800};
      }
    }
  }
`,A=({tokenName:n,tokenId:d,buttonType:T,children:D})=>{const{formatMessage:u}=(0,h.Z)(),{location:{pathname:_}}=(0,C.k6)();return(0,t.jsx)(J,{to:`${_}/${d}`,title:u(z[T],{target:n}),children:D})};A.propTypes={tokenName:s.string.isRequired,tokenId:s.oneOfType([s.string,s.number]).isRequired,buttonType:s.string,children:s.node.isRequired},A.defaultProps={buttonType:"edit"};const N=({tokenName:n,tokenId:d})=>(0,t.jsx)(A,{tokenName:n,tokenId:d,buttonType:"read",children:(0,t.jsx)(k.Z,{})});N.propTypes={tokenName:s.string.isRequired,tokenId:s.oneOfType([s.string,s.number]).isRequired};const Z=({tokenName:n,tokenId:d})=>(0,t.jsx)(A,{tokenName:n,tokenId:d,children:(0,t.jsx)(H.Z,{})});Z.propTypes={tokenName:s.string.isRequired,tokenId:s.oneOfType([s.string,s.number]).isRequired};const B=({permissions:n,headers:d,contentType:T,isLoading:D,tokens:u,onConfirmDelete:_,tokenType:l})=>{const{canDelete:g,canUpdate:m,canRead:L}=n;return(0,t.jsx)(i.DynamicTable,{headers:d,contentType:T,rows:u,withBulkActions:g||m||L,isLoading:D,onConfirmDelete:_,children:(0,t.jsx)(x,{tokenType:l,permissions:n,onConfirmDelete:_})})};B.propTypes={tokens:s.array,permissions:s.shape({canRead:s.bool,canDelete:s.bool,canUpdate:s.bool}).isRequired,headers:s.arrayOf(s.shape({cellFormatter:s.func,key:s.string.isRequired,metadatas:s.shape({label:s.string.isRequired,sortable:s.bool}).isRequired,name:s.string.isRequired})),contentType:s.string.isRequired,isLoading:s.bool,onConfirmDelete:s.func,tokenType:s.string.isRequired},B.defaultProps={tokens:[],headers:[],isLoading:!1,onConfirmDelete(){}};const x=({tokenType:n,permissions:d,rows:T,withBulkActions:D,onConfirmDelete:u})=>{const{canDelete:_,canUpdate:l,canRead:g}=d,[{query:m}]=(0,i.useQueryParams)(),{formatMessage:L}=(0,h.Z)(),[,c]=m?m.sort.split(":"):"ASC",{push:f,location:{pathname:F}}=(0,C.k6)(),{trackUsage:y}=(0,i.useTracking)(),V=T.sort((o,E)=>{const v=o.name.localeCompare(E.name);return c==="DESC"?-v:v});return(0,t.jsx)(I.p,{children:V.map(o=>(0,t.jsxs)(R.Tr,{...(0,i.onRowClick)({fn(){y("willEditTokenFromList",{tokenType:n}),f(`${F}/${o.id}`)},condition:l}),children:[(0,t.jsx)(M.Td,{maxWidth:(0,i.pxToRem)(250),children:(0,t.jsx)(O.Z,{textColor:"neutral800",fontWeight:"bold",ellipsis:!0,children:o.name})}),(0,t.jsx)(M.Td,{maxWidth:(0,i.pxToRem)(250),children:(0,t.jsx)(O.Z,{textColor:"neutral800",ellipsis:!0,children:o.description})}),(0,t.jsx)(M.Td,{children:(0,t.jsx)(O.Z,{textColor:"neutral800",children:(0,t.jsx)(i.RelativeTime,{timestamp:new Date(o.createdAt)})})}),(0,t.jsx)(M.Td,{children:o.lastUsedAt&&(0,t.jsx)(O.Z,{textColor:"neutral800",children:(0,t.jsx)(i.RelativeTime,{timestamp:new Date(o.lastUsedAt),customIntervals:[{unit:"hours",threshold:1,text:L({id:"Settings.apiTokens.lastHour",defaultMessage:"last hour"})}]})})}),D&&(0,t.jsx)(M.Td,{children:(0,t.jsxs)(K.k,{justifyContent:"end",children:[l&&(0,t.jsx)(Z,{tokenName:o.name,tokenId:o.id}),!l&&g&&(0,t.jsx)(N,{tokenName:o.name,tokenId:o.id}),_&&(0,t.jsx)(S,{tokenName:o.name,onClickDelete:()=>u(o.id),tokenType:n})]})})]},o.id))})};x.defaultProps={rows:[],withBulkActions:!1},x.propTypes={rows:s.array,permissions:s.shape({canRead:s.bool,canDelete:s.bool,canUpdate:s.bool}).isRequired,onConfirmDelete:s.func.isRequired,tokenType:s.string.isRequired,withBulkActions:s.bool}}}]);
