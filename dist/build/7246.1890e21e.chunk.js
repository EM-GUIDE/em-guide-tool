"use strict";(self.webpackChunkem_guide_app=self.webpackChunkem_guide_app||[]).push([[7246],{47246:(S,u,s)=>{s.r(u),s.d(u,{default:()=>ds});var e=s(56940),t=s(30956),E=s(93484),D=s(63355),l=s(75937),L=s(94684),_=s(44773),i=s(74065),x=s(66041),r=s(65094),f=s(24091),C=s(22512),h=s(95984),$=s(58400),F=s(9728),N=s(54997),Q=s(19493),b=s(95207),R=s(2986),V=s(31220),z=s(84093),q=s(21747),ss=s(95227),es=s(68333),k=s(7047),G=s(48288),ts=s(82018),ns=s(98305),T=s(14025),as=s(74419),Ds=s(40829),cs=s(21633),Ms=s(85845),Os=s(88720),Ps=s(66086),gs=s(88193),us=s(8232),ms=s(5337),Cs=s(4357),hs=s(41480),Rs=s(24926),Ts=s(32635),Ls=s(42052),xs=s(67620),As=s(71999),vs=s(4549),Bs=s(333),ps=s(21709),Is=s(78712);const os=()=>"todo empty role",H=({id:a,name:c,description:o,usersCount:A,icons:d,rowIndex:j,canUpdate:M})=>{const{formatMessage:v}=(0,G.Z)(),[,B]=d,O=v({id:"Roles.RoleRow.user-count",defaultMessage:"{number, plural, =0 {#  user} one {#  user} other {# users}}"},{number:A});return(0,e.jsxs)(L.Tr,{"aria-rowindex":j,...M?(0,t.onRowClick)({fn:B.onClick}):{},children:[(0,e.jsx)(_.Td,{maxWidth:(0,t.pxToRem)(130),children:(0,e.jsx)(i.Z,{ellipsis:!0,textColor:"neutral800",children:c})}),(0,e.jsx)(_.Td,{maxWidth:(0,t.pxToRem)(250),children:(0,e.jsx)(i.Z,{ellipsis:!0,textColor:"neutral800",children:o})}),(0,e.jsx)(_.Td,{children:(0,e.jsx)(i.Z,{textColor:"neutral800",children:O})}),(0,e.jsx)(_.Td,{children:(0,e.jsx)(x.k,{justifyContent:"flex-end",...t.stopPropagation,children:d.map((P,p)=>P?(0,e.jsx)(r.x,{paddingLeft:p===0?0:1,children:(0,e.jsx)(f.h,{onClick:P.onClick,label:P.label,noBorder:!0,icon:P.icon})},P.label):null)})})]},a)};H.propTypes={id:T.number.isRequired,name:T.string.isRequired,description:T.string.isRequired,usersCount:T.number.isRequired,icons:T.array.isRequired,rowIndex:T.number.isRequired,canUpdate:T.bool},H.defaultProps={canUpdate:!1};const ls={roleToDelete:null,showModalConfirmButtonLoading:!1,shouldRefetchData:!1},_s=(a,c)=>(0,as.default)(a,o=>{switch(c.type){case"ON_REMOVE_ROLES":{o.showModalConfirmButtonLoading=!0;break}case"ON_REMOVE_ROLES_SUCCEEDED":{o.shouldRefetchData=!0,o.roleToDelete=null;break}case"RESET_DATA_TO_DELETE":{o.shouldRefetchData=!1,o.roleToDelete=null,o.showModalConfirmButtonLoading=!1;break}case"SET_ROLE_TO_DELETE":{o.roleToDelete=c.id;break}default:return o}}),is=({canCreate:a,canDelete:c,canUpdate:o,refetchRoles:A})=>{const{formatMessage:d}=(0,G.Z)(),{formatAPIError:j}=(0,t.useAPIErrorHandler)(),M=(0,t.useNotification)(),[v,B]=(0,l.useState)(!1),{push:O}=(0,ts.k6)(),[{selectedRoles:P,showModalConfirmButtonLoading:p,roleToDelete:J},W]=(0,l.useReducer)(_s,ls),{post:X}=(0,t.getFetchClient)(),Y=async()=>{try{W({type:"ON_REMOVE_ROLES"}),await X("/admin/roles/batch-delete",{ids:[J]}),await A(),W({type:"RESET_DATA_TO_DELETE"})}catch(n){M({type:"warning",message:j(n)})}I()},U=(0,l.useCallback)(n=>{O(`/settings/roles/duplicate/${n}`)},[O]),K=()=>O("/settings/roles/new"),y=(0,l.useCallback)(n=>{W({type:"SET_ROLE_TO_DELETE",id:n}),I()},[]),I=()=>B(n=>!n),g=(0,l.useCallback)(n=>{O(`/settings/roles/${n}`)},[O]),Z=(0,l.useCallback)((n,m)=>{n.preventDefault(),n.stopPropagation(),m.usersCount?M({type:"info",message:{id:"Roles.ListPage.notification.delete-not-allowed"}}):y(m.id)},[M,y]),w=(0,l.useCallback)((n,m)=>{n.preventDefault(),n.stopPropagation(),U(m.id)},[U]),Es=(0,l.useCallback)(n=>[...a?[{onClick:m=>w(m,n),label:d({id:"app.utils.duplicate",defaultMessage:"Duplicate"}),icon:(0,e.jsx)(q.Z,{})}]:[],...o?[{onClick:()=>g(n.id),label:d({id:"app.utils.edit",defaultMessage:"Edit"}),icon:(0,e.jsx)(ss.Z,{})}]:[],...c?[{onClick:m=>Z(m,n),label:d({id:"global.delete",defaultMessage:"Delete"}),icon:(0,e.jsx)(es.Z,{})}]:[]],[d,Z,w,g,a,o,c]);return{handleNewRoleClick:K,getIcons:Es,selectedRoles:P,isWarningDeleteAllOpened:v,showModalConfirmButtonLoading:p,handleToggleModal:I,handleDeleteData:Y}},rs=()=>{const{formatMessage:a}=(0,G.Z)();(0,t.useFocusWhenNavigate)();const c=(0,E.useSelector)(D.s),[{query:o}]=(0,t.useQueryParams)(),{isLoading:A,allowedActions:{canCreate:d,canDelete:j,canRead:M,canUpdate:v}}=(0,t.useRBAC)(c.settings.roles),{roles:B,isLoading:O,refetch:P}=(0,ns.u)({filters:o?._q?{name:{$containsi:o._q}}:void 0},{cacheTime:0,enabled:!A&&M}),{handleNewRoleClick:p,getIcons:J,isWarningDeleteAllOpened:W,showModalConfirmButtonLoading:X,handleToggleModal:Y,handleDeleteData:U}=is({refetchRoles:P,canCreate:d,canDelete:j,canUpdate:v}),K=B.length+1,y=6;if(A)return(0,e.jsx)(C.o,{children:(0,e.jsx)(t.LoadingIndicatorPage,{})});const I=a({id:"global.roles",defaultMessage:"roles"});return(0,e.jsxs)(C.o,{children:[(0,e.jsx)(t.SettingsPageTitle,{name:"Roles"}),(0,e.jsx)(h.T,{primaryAction:d?(0,e.jsx)($.z,{onClick:p,startIcon:(0,e.jsx)(k.Z,{}),size:"S",children:a({id:"Settings.roles.list.button.add",defaultMessage:"Add new role"})}):null,title:I,subtitle:a({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),as:"h2"}),M&&(0,e.jsx)(F.Z,{startActions:(0,e.jsx)(t.SearchURLQuery,{label:a({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:I})})}),M&&(0,e.jsxs)(N.D,{children:[(0,e.jsxs)(Q.i,{colCount:y,rowCount:K,footer:d?(0,e.jsx)(b.c,{onClick:p,icon:(0,e.jsx)(k.Z,{}),children:a({id:"Settings.roles.list.button.add",defaultMessage:"Add new role"})}):null,children:[(0,e.jsx)(R.h,{children:(0,e.jsxs)(L.Tr,{"aria-rowindex":1,children:[(0,e.jsx)(_.Th,{children:(0,e.jsx)(i.Z,{variant:"sigma",textColor:"neutral600",children:a({id:"global.name",defaultMessage:"Name"})})}),(0,e.jsx)(_.Th,{children:(0,e.jsx)(i.Z,{variant:"sigma",textColor:"neutral600",children:a({id:"global.description",defaultMessage:"Description"})})}),(0,e.jsx)(_.Th,{children:(0,e.jsx)(i.Z,{variant:"sigma",textColor:"neutral600",children:a({id:"global.users",defaultMessage:"Users"})})}),(0,e.jsx)(_.Th,{children:(0,e.jsx)(V.T,{children:a({id:"global.actions",defaultMessage:"Actions"})})})]})}),(0,e.jsx)(z.p,{children:B?.map((g,Z)=>(0,e.jsx)(H,{id:g.id,name:g.name,description:g.description,usersCount:g.usersCount,icons:J(g),rowIndex:Z+2,canUpdate:v},g.id))})]}),!K&&!O&&(0,e.jsx)(os,{})]}),(0,e.jsx)(t.ConfirmDialog,{isOpen:W,onConfirm:U,isConfirmButtonLoading:X,onToggleDialog:Y})]})},ds=()=>{const a=(0,E.useSelector)(D.s);return(0,e.jsx)(t.CheckPagePermissions,{permissions:a.settings.roles.main,children:(0,e.jsx)(rs,{})})}},98305:(S,u,s)=>{s.d(u,{u:()=>l});var e=s(75937),t=s(30956),E=s(48288),D=s(40829);const l=(L={},_={})=>{const{id:i="",...x}=L,{get:r}=(0,t.useFetchClient)(),{locale:f}=(0,E.Z)(),C=(0,t.useCollator)(f,{sensitivity:"base"}),{data:h,error:$,isError:F,isLoading:N,refetch:Q}=(0,D.useQuery)(["roles",i,x],async()=>{const{data:R}=await r(`/admin/roles/${i??""}`,{params:x});return R},_);return{roles:e.useMemo(()=>{let R=[];return h&&(Array.isArray(h.data)?R=h.data:R=[h.data]),[...R].sort((V,z)=>C.compare(V.name,z.name))},[h,C]),error:$,isError:F,isLoading:N,refetch:Q}}},9728:(S,u,s)=>{s.d(u,{Z:()=>E});var e=s(56940),t=s(66041);const E=({startActions:D,endActions:l})=>!D&&!l?null:(0,e.jsxs)(t.k,{justifyContent:"space-between",alignItems:"flex-start",paddingBottom:4,paddingLeft:10,paddingRight:10,children:[(0,e.jsx)(t.k,{gap:2,wrap:"wrap",children:D}),(0,e.jsx)(t.k,{gap:2,shrink:0,wrap:"wrap",children:l})]})},95207:(S,u,s)=>{s.d(u,{c:()=>x});var e=s(56940),t=s(19681),E=s(65094),D=s(43669),l=s(66041),L=s(74065);const _=(0,t.default)(E.x)`
  height: ${24/16}rem;
  width: ${24/16}rem;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;

  svg {
    height: ${10/16}rem;
    width: ${10/16}rem;
  }

  svg path {
    fill: ${({theme:r})=>r.colors.primary600};
  }
`,i=(0,t.default)(E.x)`
  border-radius: 0 0 ${({theme:r})=>r.borderRadius} ${({theme:r})=>r.borderRadius};
  display: block;
  width: 100%;
  border: none;
`,x=({children:r,icon:f,...C})=>(0,e.jsxs)("div",{children:[(0,e.jsx)(D.i,{}),(0,e.jsx)(i,{as:"button",background:"primary100",padding:5,...C,children:(0,e.jsxs)(l.k,{children:[(0,e.jsx)(_,{"aria-hidden":!0,background:"primary200",children:f}),(0,e.jsx)(E.x,{paddingLeft:3,children:(0,e.jsx)(L.Z,{variant:"pi",fontWeight:"bold",textColor:"primary600",children:r})})]})})]})}}]);
